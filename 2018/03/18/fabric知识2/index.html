<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <title>Hyperledger Fabric知识记录（2）-- Fabric网络的自启动和手启动</title>
  <meta name="description" content="Hyperledger Fabric">
  <meta name="author" content="黎跃春">

  <meta name="keywords" content="区块链技术,区块链视频,区块链学习,solidity 中文,fabric 中文,hyperledger 中文"
  />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hyperledger Fabric知识记录（2）-- Fabric网络的自启动和手启动">
  <meta name="twitter:description" content="Hyperledger Fabric">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Hyperledger Fabric知识记录（2）-- Fabric网络的自启动和手启动">
  <meta property="og:description" content="Hyperledger Fabric">
  <meta property="og:site_name" content="区块链技术,区块链视频,区块链学习,solidity 中文,fabric 中文,hyperledger 中文e"
  />


  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">


  <link rel="stylesheet" href=" /css/main.css ">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="/2018/03/18/fabric%E7%9F%A5%E8%AF%862/">
  <link rel="alternate" type="application/rss+xml" title="Gump区块链博客" href=" /feed.xml
    ">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

  <!-- 站点统计 -->
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>

  <!-- 百度统计 -->
  

  <!-- google 统计 -->
  

  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>

</head>


<body>

  <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      分类
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
          
      </div>
    </span> <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">
          <a href="/#blog" title="前往 Gump区块链博客 的主页" class="blog-button">
            <div class="img"><img src="/images/mysculpture.png" alt="img"></div>
            <div class="info">
              <div class="info-back">
                <h2 style="font-size: 14px">
                   Gump 
                </h2>´
                <p style="font-size: 6px">
                   区块链 
                </p>
              </div>
            </div>
          </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Gump区块链博客" class="blog-button">Gump区块链博客</a></h1>
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">杨俊诚，广东技术师范大学本科在读生，亚洲DACA区块链协会和清华大学区块链协会联合举办的“区块链技术公开课”六期学员，计算机编程技术和区块链底层技术爱好者。</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" /> 


        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                <li class="navigation__item"><a href="/tags" title="tags">分类</a></li>
                
                <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>
        </div>

        <div style="display:flex;justify-content:center;-webkit-justify-content:center">
          <div style="display:flex;flex-direction:column;align-items:center;-webkit-flex-direction:column;-webkit-align-items:center;margin-right:10px">
            <img src="/images/public.jpg" style="width:120px;height:120px;margin-top:30px;margin-bottom:10px" />
            <span class="panel-cover__subtitle panel-subtitle" style="font-size: 12px">链说公众号</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;-webkit-flex-direction:column;-webkit-align-items:center;margin-left:10px">
            <img src="/images/mycode.png" style="width:120px;height:120px;margin-top:30px;margin-bottom:10px" />
            <span class="panel-cover__subtitle panel-subtitle" style="font-size: 12px">博主微信号</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  
  <div class="panel-cover--overlay cover-clear"></div>
  

  </div>
</header>


  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">Hyperledger Fabric知识记录（2）-- Fabric网络的自启动和手启动</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/>
      <time datetime="2018-03-18 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2018-03-18</time>

      <span id="busuanzi_container_page_pv"> | 阅读：<span id="busuanzi_value_page_pv"></span>次</span>
    </p>
    </div>
  </header>

  <section class="post">
    <blockquote>
  <p>来源：BLOGS OF GUMP</p>

  <p>编辑：杨俊诚</p>
</blockquote>

<hr />
<h1 id="hyperledger-fabric知识记录2-fabric网络的自启动和手启动">Hyperledger Fabric知识记录（2）– Fabric网络的自启动和手启动</h1>
<hr />
<p>Fabric作为一个软件应用程序的开发平台，所有的开发的程序要运行在Fabric，就必须提供这么一个网络环境。
启动网络有这么两种方法：自启动和手启动</p>

<h2 id="自启动">自启动</h2>
<h3 id="网络建立和前提准备">网络建立和前提准备</h3>

<p>首先我们需要先建立一个网络，操作过程如下：</p>

<p>必须先进入到Fabric相对应目录，这个目录使我们下载的Fabric基础平台下的fabric-samples下的first-network里</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ls
autoproxy.pac  Downloads         go    公共的  视频  文档  音乐
Desktop        examples.desktop  hyfa  模板    图片  下载  桌面
$ cd hyfa/
$ ls
bootstrap.sh  fabric-samples
$ cd fabric-samples/first-network
$ ls
base                docker-compose-cli.yaml           eyfn.sh
byfn.sh             docker-compose-couch-org3.yaml    org3-artifacts
channel-artifacts   docker-compose-couch.yaml         README.md
configtx.yaml       docker-compose-e2e-template.yaml  scripts
crypto-config.yaml  docker-compose-org3.yaml

</code></pre>
</div>
<p>在<code class="highlighter-rouge">first-network</code>目录下有两个可执行的自动化脚本文件<code class="highlighter-rouge">byfn.sh</code>和<code class="highlighter-rouge">eyfn.sh</code>, 这两个脚本的启动顺序是先执行byfn.sh再执行eyfn.sh（eyfn.sh不是必须的，eyfn.sh的作用稍后介绍）</p>

<p>查看帮助信息:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ./byfn.sh --help
Usage:
  byfn.sh up|down|restart|generate|upgrade [-c &lt;channel name&gt;] [-t &lt;timeout&gt;] [-d &lt;delay&gt;] [-f &lt;docker-compose-file&gt;] [-s &lt;dbtype&gt;] [-i &lt;imagetag&gt;]
  byfn.sh -h|--help (print this message)
    &lt;mode&gt; - one of 'up', 'down', 'restart' or 'generate'
      - 'up' - bring up the network with docker-compose up
      - 'down' - clear the network with docker-compose down
      - 'restart' - restart the network
      - 'generate' - generate required certificates and genesis block
      - 'upgrade'  - upgrade the network from v1.0.x to v1.1
    -c &lt;channel name&gt; - channel name to use (defaults to "mychannel")
    -t &lt;timeout&gt; - CLI timeout duration in seconds (defaults to 10)
    -d &lt;delay&gt; - delay duration in seconds (defaults to 3)
    -f &lt;docker-compose-file&gt; - specify which docker-compose file use (defaults to docker-compose-cli.yaml)
    -s &lt;dbtype&gt; - the database backend to use: goleveldb (default) or couchdb
    -l &lt;language&gt; - the chaincode language: golang (default) or node
    -i &lt;imagetag&gt; - the tag to be used to launch the network (defaults to "latest")

Typically, one would first generate the required certificates and genesis block, then bring up the network. e.g.:

	byfn.sh generate -c mychannel
	byfn.sh up -c mychannel -s couchdb
        byfn.sh up -c mychannel -s couchdb -i 1.1.0-alpha
	byfn.sh up -l node
	byfn.sh down -c mychannel
        byfn.sh upgrade -c mychannel

Taking all defaults:
	byfn.sh generate
	byfn.sh up
	byfn.sh down
</code></pre>
</div>
<p>这里显示其一些帮助信息，其中显示的执行模式是我们需要重点认识的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;mode&gt; - one of 'up', 'down', 'restart' or 'generate'
      - 'up' - bring up the network with docker-compose up
      - 'down' - clear the network with docker-compose down
      - 'restart' - restart the network
      - 'generate' - generate required certificates and genesis block
      - 'upgrade'  - upgrade the network from v1.0.x to v1.1
    -c &lt;channel name&gt; - channel name to use (defaults to "mychannel")
    -t &lt;timeout&gt; - CLI timeout duration in seconds (defaults to 10)
    -d &lt;delay&gt; - delay duration in seconds (defaults to 3)
    -f &lt;docker-compose-file&gt; - specify which docker-compose file use (defaults to docker-compose-cli.yaml)
    -s &lt;dbtype&gt; - the database backend to use: goleveldb (default) or couchdb
    -l &lt;language&gt; - the chaincode language: golang (default) or node
    -i &lt;imagetag&gt; - the tag to be used to launch the network (defaults to "latest")
</code></pre>
</div>
<p>对其执行模式解释如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>up：启动网络
down：清除网络（关闭网络）
restart：重新启动网络
generate：生成证书及创世块（生成网络环境中的组织结构及相应身份证书）
upgrade：将网络从1.0升级到1.1（更新网络）

-c：用于指定channelName（通道名称），默认值"mychannel"
-t：CLI timeout时间，默认值10（超时）
-d：延迟启动，默认值3
-f：使用指定的网络拓扑结构文件，默认使用docker-compose-cli.yaml
-s：指定使用的数据库，可选 goleveldb(默认是用这个)或couchdb
-l：指定chaincode使用的语言，可选golang 或node
-i：指定镜像tag，默认 "latest"
详细参数可通过./byfn.sh help查看
</code></pre>
</div>
<p>帮助信息里还列出了具体的命令实例</p>

<div class="highlighter-rouge"><pre class="highlight"><code>byfn.sh generate -c mychannel
byfn.sh up -c mychannel -s couchdb
byfn.sh up -c mychannel -s couchdb -i 1.1.0-alpha
byfn.sh up -l node
byfn.sh down -c mychannel
byfn.sh upgrade -c mychannel
</code></pre>
</div>
<p>生成证书和密钥</p>

<p>为各种网络实体生成所有证书和密钥，用于引导订购服务以及配置通道所需的一系列配置事务</p>

<p><code class="highlighter-rouge">$ sudo ./byfn.sh -m generate</code></p>

<p>在这个命令中，-m代表指定执行的模式
此外要有sudo，即指定权限给它，不然没有权限执行这个操作
下面就是没赋权限而执行该命令的结果</p>

<div class="highlighter-rouge"><pre class="highlight"><code>./byfn.sh -m generate
Generating certs and genesis block for with channel 'mychannel' and CLI timeout of '10' seconds and CLI delay of '3' seconds
Continue? [Y/n] y
proceeding ...
/home/parallels/hyfa/fabric-samples/first-network/../bin/cryptogen

##########################################################
##### Generate certificates using cryptogen tool #########
##########################################################
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/ca/c69b91ea56981b576367c776c472b505fdaabeba181bbaf869fe89f37095bf57_sk': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/ca/ca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/client.crt': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/client.key': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/admincerts/Admin@example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/signcerts/Admin@example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/cacerts/ca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/tlscacerts/tlsca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/keystore/997b20bbb1fef4671bbf2a72b1c1102cc8fe4ae8db9fef606dc90650a9109938_sk': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/tlsca/ddf43290e008a47ccbd4d7b835a7252719eb6f834d93277ce500e1f76f787758_sk': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.crt': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.key': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/admincerts/Admin@example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/signcerts/orderer.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/cacerts/ca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/keystore/33251e9123b2df6765c0f8df418630617d1fc28bbf65b1e41dd6c986931711db_sk': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/msp/admincerts/Admin@example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/msp/cacerts/ca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/signcerts/peer0.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/keystore/9fb5c157b69d4dcd5425eafd27ab84a76b3ae52a309adcaed0ef8aad61de2ce4_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/signcerts/peer1.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/keystore/62da20f0b492eeaaa8cf16d93aff48e4441b956889dfce128c953d949ca1a07b_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/ca/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/ca/2a253dcdcba35090bcdc4d03f367af95abc8e3823663666bd9b65021a9aaa3bd_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/client.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/client.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/admincerts/User1@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/signcerts/User1@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/keystore/2c75bbb03a89eb45750d4f114e36732e604305459267f5af215ea34cb0f7652f_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/client.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/client.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/4b384a1771e6ec8497a69b28cb24acc8aa38b36ee0ac1495cbd3285e0e44e1ea_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/tlsca/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/tlsca/b5f6ada8351de3edd20fc25c8cff6414b677d9e119521dc55b486204423efbf3_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/signcerts/peer0.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/keystore/633da2e97cf3a2575b415cf21995f977198ae286e609703507827d675c19ca8d_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/signcerts/peer1.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/keystore/7008d5f985e0abf826de6b11d9221fdec39988bcc363d1b5ec2ce40a30d72170_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/ca/0616674037b25840190d293ebac2d801bf65aaa8dea7ba6811e5db43f20b2b8f_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/da2b59100440276ee9aec0c618a53618e6826dfec356cbf17ee948f03a0af7c1_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/ca.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/client.crt': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/client.key': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/admincerts/User1@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/8aed375427378d5d575f80ffa4ac8b5e92601d6955a5a007510e4c94b301476c_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/tlsca/7e8aff78f41f0a98c978f80f47a6f556617725303efe65519ba4d7f2c5e36ac8_sk': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/msp/config.yaml': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': Permission denied
rm: cannot remove 'crypto-config/peerOrganizations/org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': Permission denied
+ cryptogen generate --config=./crypto-config.yaml
org1.example.com
2018-06-21 20:23:21.929 CST [bccsp_sw] storePrivateKey -&gt; ERRO 001 Failed storing private key [ae27c1a50ef8a80bac7127a0c9c4e147c48a7ba5a1f80407a8a9fdce648d3790]: [open crypto-config/peerOrganizations/org1.example.com/ca/ae27c1a50ef8a80bac7127a0c9c4e147c48a7ba5a1f80407a8a9fdce648d3790_sk: permission denied]
Error generating signCA for org org1.example.com:
Failed storing key [ECDSAP256]: Failed storing ECDSA private key [open crypto-config/peerOrganizations/org1.example.com/ca/ae27c1a50ef8a80bac7127a0c9c4e147c48a7ba5a1f80407a8a9fdce648d3790_sk: permission denied]
+ res=1
+ set +x
Failed to generate certificates...
</code></pre>
</div>
<p>我们执行ll命令查看如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pwd
/home/parallels/hyfa/fabric-samples/first-network
$ ll
总用量 108
drwxr-xr-x  7 root root  4096 Jun 20 18:01 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 20 18:01 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
drwxr-xr-x  4 root root  4096 Jun 20 18:01 crypto-config/
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3091 Jun 20 18:01 docker-compose-e2e.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/
</code></pre>
</div>
<p>从上面可以看到first-network包下面的文件可被执行操作的权限是root，而不是当前用户</p>

<p>正确执行结果：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ./byfn.sh -m generate
[sudo] parallels 的密码：
Generating certs and genesis block for with channel 'mychannel' and CLI timeout of '10' seconds and CLI delay of '3' seconds
Continue? [Y/n] y
proceeding ...
/home/parallels/hyfa/fabric-samples/first-network/../bin/cryptogen

##########################################################
##### Generate certificates using cryptogen tool #########
##########################################################
+ cryptogen generate --config=./crypto-config.yaml
org1.example.com
org2.example.com
+ res=0
+ set +x

/home/parallels/hyfa/fabric-samples/first-network/../bin/configtxgen
##########################################################
#########  Generating Orderer Genesis block ##############
##########################################################
+ configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block
2018-06-20 18:01:04.267 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-20 18:01:04.274 CST [msp] getMspConfig -&gt; INFO 002 Loading NodeOUs
2018-06-20 18:01:04.275 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs
2018-06-20 18:01:04.275 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 004 Generating genesis block
2018-06-20 18:01:04.275 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 005 Writing genesis block
+ res=0
+ set +x

#################################################################
### Generating channel configuration transaction 'channel.tx' ###
#################################################################
+ configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel
2018-06-20 18:01:04.283 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-20 18:01:04.293 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx
2018-06-20 18:01:04.296 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs
2018-06-20 18:01:04.297 CST [msp] getMspConfig -&gt; INFO 004 Loading NodeOUs
2018-06-20 18:01:04.321 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Writing new channel tx
+ res=0
+ set +x

#################################################################
#######    Generating anchor peer update for Org1MSP   ##########
#################################################################
+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP
2018-06-20 18:01:04.330 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-20 18:01:04.337 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2018-06-20 18:01:04.337 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update
+ res=0
+ set +x

#################################################################
#######    Generating anchor peer update for Org2MSP   ##########
#################################################################
+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP
2018-06-20 18:01:04.347 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-20 18:01:04.354 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2018-06-20 18:01:04.354 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update
+ res=0
+ set +x

</code></pre>
</div>

<p>这里解析一下打印出来的信息
<code class="highlighter-rouge">cryptogen generate --config=./crypto-config.yaml</code>
这句是执行cryptogen命令，generate是cryptogen命令下的子命令，–config是参数命令，指定依据./crypto-config.yaml这么一个配置文件来执行生成相应的组织结构和身份证书</p>

<p><img src="/images/media/fabric/fabric07.png" alt="" /></p>

<p><img src="/images/media/fabric/fabric08.png" alt="" /></p>

<p><img src="/images/media/fabric/fabric09.png" alt="" /></p>

<p><code class="highlighter-rouge">configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</code>
这句是执行configtxgen命令，-profile是参数命令，用于指定依据TwoOrgsOrdererGenesis这么个配置模板文件，-outputBlock参数后面加路径:./channel-artifacts/genesis.block来指定命令运行后输出生成的genesis.block文件存放在该路径下。
这句命令是用以让orderer节点生成创世块（第一个区块）。这里还要提一下就是TwoOrgsOrdererGenesis这个配置模板，它具体被记录在configtx.yaml里</p>

<p><img src="/images/media/fabric/fabric10.png" alt="" /></p>

<p><code class="highlighter-rouge">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</code>
这句是用以生成通道的配置交易文件，同样执行的是configtxgen命令，-profile是参数命令，用于指定依据TwoOrgsChannel这么个配置模板文件，-outputCreateChannelTx参数后面加路径:./channel-artifacts/channel.tx来指定命令运行后输出生成的channel.tx文件存放在该路径下，-channelID参数用以指定通道名称</p>

<p><code class="highlighter-rouge">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</code>
和
<code class="highlighter-rouge">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</code>这两条命令用于生成对两个组织的锚节点配置更新文件，这个命令还多一个参数-asOrg用于指定生成哪个组织的锚节点配置更新文件。</p>

<p>这里其实是执行<code class="highlighter-rouge">sudo ./byfn.sh -m generate</code>这么一个命令代替以上四个命令执行</p>

<p>执行完这个命令后会在fabric-samples/first-network路径下生成一个名为channel-artifacts的文件包，这个包存放着上面所说的生成的四个文件</p>

<p><img src="/images/media/fabric/fabric11.png" alt="" /></p>

<p><img src="/images/media/fabric/fabric12.png" alt="" /></p>

<p>此外，生成的组织结构和身份证书都存放在crypto-config这个新生成的文件包里</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pwd
/home/parallels/hyfa/fabric-samples/first-network
parallels@parallels-vm:~/hyfa/fabric-samples/first-network$ ll
总用量 108
drwxr-xr-x  7 root root  4096 Jun 20 18:01 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 20 18:01 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
drwxr-xr-x  4 root root  4096 Jun 20 18:01 crypto-config/
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3091 Jun 20 18:01 docker-compose-e2e.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/

</code></pre>
</div>

<p><img src="/images/media/fabric/fabric13.png" alt="" /></p>

<p><img src="/images/media/fabric/fabric14.png" alt="" /></p>

<p><img src="/images/media/fabric/fabric15.png" alt="" /></p>

<p>以上是自启动网络的前提准备条件，归纳一下就是：
1.生成组织结构及身份证书
2.创建Orderer的初始区块，以启动Orderer服务
3.生成应用通道配置交易文件，用来生成应用通道（生成通道时，是会依据这些配置文件），指定通道内相应的成员（组织，节点）及访问策略
4.生成锚节点更新配置文件,用来指定配置锚节点</p>

<h3 id="启动网络">启动网络</h3>

<p>前提准备完成后，接下来就是启动网络
<code class="highlighter-rouge">sudo ./byfn.sh -m up</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ./byfn.sh -m up
Starting with channel 'mychannel' and CLI timeout of '10' seconds and CLI delay of '3' seconds
Continue? [Y/n] y
proceeding ...
2018-06-20 10:03:06.985 UTC [main] main -&gt; INFO 001 Exiting.....
LOCAL_VERSION=1.1.0
DOCKER_IMAGE_VERSION=1.1.0
Creating network "net_byfn" with the default driver
Creating volume "net_peer0.org2.example.com" with default driver
Creating volume "net_peer1.org2.example.com" with default driver
Creating volume "net_peer1.org1.example.com" with default driver
Creating volume "net_peer0.org1.example.com" with default driver
Creating volume "net_orderer.example.com" with default driver
Creating peer1.org2.example.com
Creating peer0.org1.example.com
Creating orderer.example.com
Creating peer0.org2.example.com
Creating peer1.org1.example.com
Creating cli


 ____    _____      _      ____    _____
/ ___|  |_   _|    / \    |  _ \  |_   _|
\___ \    | |     / _ \   | |_) |   | |
 ___) |   | |    / ___ \  |  _ &lt;    | |
|____/    |_|   /_/   \_\ |_| \_\   |_|

Bld your first network (BYFN) end-to-end test

Channel name : mychannel
Creating channel...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
+ peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
+ res=0
+ set +x
2018-06-20 10:03:11.476 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:11.504 UTC [channelCmd] InitCmdFactory -&gt; INFO 002 Endorser and orderer connections initialized
2018-06-20 10:03:11.707 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Channel "mychannel" is created successfully =====================

Hvig all peers join the channel...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
+ peer channel join -b mychannel.block
+ res=0
+ set +x
2018-06-20 10:03:11.752 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:11.776 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
2018-06-20 10:03:11.776 UTC [main] main -&gt; INFO 003 Exiting.....
===================== peer0.org1 joined on the channel "mychannel" =====================
COE_EER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer1.org1.example.com:7051
+ peer channel join -b mychannel.block
+ res=0
+ set +x
2018-06-20 10:03:14.829 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:14.859 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
2018-06-20 10:03:14.859 UTC [main] main -&gt; INFO 003 Exiting.....
===================== peer1.org1 joined on the channel "mychannel" ===================== COR_PER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org2.example.com:7051
+ peer channel join -b mychannel.block
+ res=0
+ set +x
2018-06-20 10:03:17.913 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:17.945 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
2018-06-20 10:03:17.945 UTC [main] main -&gt; INFO 003 Exiting.....
===================== peer0.org2 joined on the channel "mychannel" =====================
OREPER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer1.org2.example.com:7051
+ peer channel join -b mychannel.block
+ res=0
+ set +x
2018-06-20 10:03:20.988 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:21.025 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
2018-06-20 10:03:21.025 UTC [main] main -&gt; INFO 003 Exiting.....
===================== peer1.org2 joined on the channel "mychannel" ===================== #锚节点置文
Updating anchor peers for org1...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
+ peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
+ res=0
+ set +x
2018-06-20 10:03:24.084 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:24.106 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update
2018-06-20 10:03:24.106 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Anchor peers for org "Org1MSP" on "mychannel" is updated successfully =====================
Uatig nchor peers for org2...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org2.example.com:7051
+ peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
+ res=0
+ set +x
2018-06-20 10:03:27.153 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-06-20 10:03:27.169 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update
2018-06-20 10:03:27.169 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Anchor peers for org "Org2MSP" on "mychannel" is updated successfully =====================
测码
#在org1下peer0节点上安装链码
Installing chaincode on peer0.org1...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/
#install：peer子命令，对链码进行安装操作
#-n：指定链码名称，在安装链码时必须指定（一个通道里可以有多个链码，区分不同链码依据的是链码名称）
#-v：指定链码要安装的当前版本号（后期可以升级，指定其更新的版本号）
#-l：指定链码开发的语言及语言环境
#-p：指定要安装的链码文件所在的路径，即在github.com/chaincode/chaincode_example02/go/路径下面拥有一个链码文件
+ res=0
+ set +x
2018-06-20 10:03:30.226 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:30.226 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-06-20 10:03:30.590 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Chaincode is installed on peer0.org1 =====================

Install chaincode on peer0.org2...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org2.example.com:7051
+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/
+ res=0
+ set +x
2018-06-20 10:03:30.633 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:30.633 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-06-20 10:03:30.757 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Chaincode is installed on peer0.org2 =====================
Instantiating chaincode on peer0.org2...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org2.example.com:7051
+ peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l golang -v 1.0 -c '{"Args":["init","a","100","b","200"]}' -P 'OR	('\''Org1MSP.peer'\'','\''Org2MSP.peer'\'')'
#instantiate：peer子命令，对链码进行实例化操作
#-o：指定orderer节点
#--tls：有true或者false两种选择（如果--tls后面没有true或者false,那么默认是true），确定是否使用tls协议来保证数据的完整性和安全性
#--cafile：如果启用tls协议验证,那么就必须使用--cafile参数来指定其ca证书，后面跟的是存放证书文件的路径
#-C：指定所用通道名称
#-n：指定所操作链码名称
#-l：指定链码开发的语言及语言环境
#-v：指定链码要安装的当前版本号（后期可以升级，指定其更新的版本号）
#-c：实例化链码时，指定初始化参数
#-P：指定背书策略，也就是收集背书节点签名，这里'OR('\''Org1MSP.peer'\'','\''Org2MSP.peer'\'')'表示的是收集的背书节点签名只要是org1下的所有节点签名或者是org2下的所有节点签名即可，OR表示的就是逻辑或。
+ res=0
+ set +x
2018-06-20 10:03:30.805 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:30.805 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-06-20 10:03:42.893 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Chaincode Instantiation on peer0.org2 on channel 'mychannel' is successful =====================

Querying chaincode on peer0.org1...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
===================== Querying on peer0.org1 on channel 'mychannel'... ===================== Attempting to Query peer0.org1 ...3 secs
+ peer chaincode query -C mychannel -n mycc -c '{"Args":["query","a"]}'
+ res=0
+ set +x

2018-06-20 10:03:45.999 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:45.999 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
Query Result: 100
2018-06-20 10:03:57.342 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Query on peer0.org1 on channel 'mychannel' is successful =====================
ending invoke transaction on peer0.org1...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
+ peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -c '{"Args":["invoke","a","b","10"]}'
+ res=0
+ set +x
+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/
2018-06-20 10:03:57.494 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:57.494 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-06-20 10:03:57.513 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 003 Chaincode invoke successful. result: status:200 218-06-20 10:03:57.513 UTC [main] main -&gt; INFO 004 Exiting.....
===================== Invoke transaction on peer0.org1 on channel 'mychannel' is successful =====================
Istalling chaincode on peer1.org2...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer1.org2.example.com:7051
+ res=0
+ set +x
2018-06-20 10:03:57.549 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:03:57.549 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-06-20 10:03:57.866 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Chaincode is installed on peer1.org2 =====================
urying chaincode on peer1.org2...
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org2MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer1.org2.example.com:7051
===================== Querying on peer1.org2 on channel 'mychannel'... ===================== tepting to Query peer1.org2 ...3 secs
+ peer chaincode query -C mychannel -n mycc -c '{"Args":["query","a"]}'
+ res=0
+ set +x

2018-06-20 10:04:00.929 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-06-20 10:04:00.929 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
Query Result: 90
2018-06-20 10:04:13.956 UTC [main] main -&gt; INFO 003 Exiting.....
===================== Query on peer1.org2 on channel 'mychannel' is successful =====================
====== All GOOD, BYFN execution completed ===========
 _____   _   _   ____
| ____| | \ | | |  _ \
|  _|   |  \| | | | | |
| |___  | |\  | | |_| |
|_____| |_| \_| |____/



</code></pre>
</div>
<p>出现上面的信息表示开启成功</p>

<p>如果启动发生错误,则执行关闭命令后再次执行启动命令</p>

<p>最后输出如下内容代表启动且测试成功</p>

<blockquote>
  <p>或者通过Node.js启动网络<code class="highlighter-rouge"> ./byfn.sh -m up -l node</code></p>
</blockquote>

<p>first-network会生成1个orderer+4个peer+1个CLI的网络结构，整个网络包括2个org</p>

<p>接下来我们分析其信息</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Channel name : mychannel#创建通道，通道名称为mychannel
Creating channel...
#下面是创建过程所列的一系列特定的条件和指定用到的证书
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt#指定证书路径，此路径为docker容器内路径，不是操作系统的路径，实际上启动网络就是启动docker容器
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
</code></pre>
</div>
<p>TLS:数据传输协议的一种，用来保证对数据传输的完整性和安全性
启动网络的这个过程其实包含这么几个步骤：
1.启动docker容器
2.进入到容器中
3.依据应用通道配置交易文件，创建应用通道
4.将对应节点加入到应用通道中</p>

<p>进入到docker容器中后，我们需要依据应用通道配置交易文件，创建应用通道
下面是运行peer命令，进行通道创建</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre>
</div>
<p>create：peer子命令，用于创建channel
参数说明：
-o：指定orderer节点
-c：指定通道名称（给创建的新通道命名）
-f：指定依据的应用通道配置交易文件
–tls：有true或者false两种选择（如果–tls后面没有true或者false,那么默认是true），确定是否使用tls协议来保证数据的完整性和安全性
–cafile：如果启用tls协议验证,那么就必须使用–cafile参数来指定其ca证书，后面跟的是存放证书文件的路径</p>

<p>接着将节点加入到应用通道中</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer channel join -b mychannel.block
</code></pre>
</div>
<p>-b：用以指定这么一个名为mychannel.block的文件（这个文件是应用通道被创建时生成的）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt#tls根证书文件放置路径
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key#tls私钥
CORE_PEER_LOCALMSPID=Org1MSP
CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock#虚拟机
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
CORE_PEER_TLS_ENABLED=true
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
</code></pre>
</div>
<p>我们刚才加入的的节点是org1组织下的peer0节点，而且此时也是以org1组织下的peer0身份(默认是这个节点身份） 加入到mychannel通道的，接下来要想把其他节点也加入到此通道当中，就必须切换到对应节点的身份中</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ID=cli
CORE_LOGGING_LEVEL=INFO
CORE_PEER_ADDRESS=peer0.org1.example.com:7051#这个是指明切换到哪个节点身份
</code></pre>
</div>
<p>上面这段信息是表示节点身份切换过程</p>

<p>需要说明的一点就是，同组织的节点可以用同一个身份证书，但是不同组织的节点就需要切换身份证书，此外，这里还提及了一个词汇，背书策略。
当客户端节点要发起一笔交易或者发送其他数据消息时，就需要把这个数据信息作为请求发送给组织下的peer节点，peer节点接收到数据信息后需要对其做验证，确定其合法性，如果通过验证，那么这些peer节点就会对这个信息请求实施<code class="highlighter-rouge">签名</code>，表示对你的这笔数据信息给予认可并同意提交数据。我们称这个过程为<code class="highlighter-rouge">背书签名</code>，并且称具备有这种作用的节点为<code class="highlighter-rouge">背书节点</code>。每一个组织下是会有好几个背书节点的，因此要想这个数据信息被认可，不单单是一两个背书节点给予认可就行的，需要收集到足够的背书节点签名，这样全网络才基本肯定你发起的这个数据信息请求的合法性，才能把数据信息结果保存在全网络账本里，这个过程称为<code class="highlighter-rouge">背书过程</code>。那么要收集到多少背书节点签名才行呢，这就需要立定一种标准，也就是确定由哪些节点，需要多少节点来参与进行签名，而我们对于这种标准的制定便称之为<code class="highlighter-rouge">背书策略</code>，比如’OR(‘'‘Org1MSP.peer’'’,’'‘Org2MSP.peer’'’)’表示的是收集到的背书节点签名只要是org1下的所有节点签名或者是org2下的所有节点签名即可，OR表示的就是逻辑或。有逻辑或，自然可以有逻辑与AND，像’AND(‘'‘Org1MSP.peer’'’,’'‘Org2MSP.peer’'’)’表示的就是必须收集到org1和org2两个组织下的所有背书节点签名方可，背书策略是在实例化链码时就需要指定的。</p>

<p>组织下的节点全都加入到通道后，就可以测试链码，对链码实施操作和调用</p>

<p>这里有这么几个步骤：
1.安装部署链码到节点上</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/
#install：peer子命令，对链码进行安装操作
#-n：指定链码名称，在安装链码时必须指定（一个通道里可以有多个链码，区分不同链码依据的是链码名称）
#-v：指定链码要安装的当前版本号（后期可以升级，指定其更新的版本号）
#-l：指定链码开发的语言及语言环境
#-p：指定要安装的链码文件所在的路径，即在github.com/chaincode/chaincode_example02/go/路径下面拥有一个链码文件
</code></pre>
</div>

<p>2.实例化链码</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l golang -v 1.0 -c '{"Args":["init","a","100","b","200"]}' -P 'OR	('\''Org1MSP.peer'\'','\''Org2MSP.peer'\'')'
#instantiate：peer子命令，对链码进行实例化操作
#-o：指定orderer节点
#--tls：有true或者false两种选择（如果--tls后面没有true或者false,那么默认是true），确定是否使用tls协议来保证数据的完整性和安全性
#--cafile：如果启用tls协议验证,那么就必须使用--cafile参数来指定其ca证书，后面跟的是存放证书文件的路径
#-C：指定所用通道名称
#-n：指定所操作链码名称
#-l：指定链码开发的语言及语言环境
#-v：指定链码要安装的当前版本号（后期可以升级，指定其更新的版本号）
#-c：实例化链码时，指定初始化参数，"Args"是固定格式，"init"也是固定格式，"a","100","b","200"表示初始化两个账户a和b，分别存储的金额为100和200
#-P：指定背书策略，也就是收集背书节点签名，这里'OR('\''Org1MSP.peer'\'','\''Org2MSP.peer'\'')'表示的是收集的背书节点签名只要是org1下的所有节点签名或者是org2下的所有节点签名即可，OR表示的就是逻辑或。
</code></pre>
</div>
<p>3.对链码实施调用，达到对账本内容的增删改查（这里的增删改查并不是说可以对账本数据进行查篡改，而是对数据操作的记录，即记账，也就是尽管数据可以通过增删改查进行变动，但是这个变动过程却会以数据的形式记录进区块，这一记录是不可改变的。）</p>

<p>查询操作使用peer的query子命令</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer chaincode query -C mychannel -n mycc -c '{"Args":["query","a"]}'
</code></pre>
</div>
<p>-C：指定通道
-n：指定试用的链码名称
-c：指定参数，”Args”是固定格式，”query”是与实现查询操作有关的函数名称，”a”是要查询的账户名</p>

<p>执行添加，修改，删除操作使用peer的invoke子命令
下面这个命令是实现账户间转账（修改操作）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -c '{"Args":["invoke","a","b","10"]}'
</code></pre>
</div>
<p>这里的命令参数跟前面的功能一样，这里就不在重复解释，-c后面的内容是调用链码时所传入的参数，表示的是a账户向b账户转移数量10。</p>

<p>我们用如下命令来查看当前docker容器中有哪些镜像</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker images
REPOSITORY                                                                                             TAG                 IMAGE ID            CREATED             SIZE
dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab   latest              53c8b7c13ef8        6 minutes ago       172 MB
dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9   latest              8f133a9a9245        7 minutes ago       172 MB
dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b   latest              2f7f004babf3        7 minutes ago       172 MB
hyperledger/fabric-ca                                                                                  latest              72617b4fa9b4        3 months ago        299 MB
hyperledger/fabric-ca                                                                                  x86_64-1.1.0        72617b4fa9b4        3 months ago        299 MB
hyperledger/fabric-tools                                                                               latest              b7bfddf508bc        3 months ago        1.46 GB
hyperledger/fabric-tools                                                                               x86_64-1.1.0        b7bfddf508bc        3 months ago        1.46 GB
hyperledger/fabric-orderer                                                                             latest              ce0c810df36a        3 months ago        180 MB
hyperledger/fabric-orderer                                                                             x86_64-1.1.0        ce0c810df36a        3 months ago        180 MB
hyperledger/fabric-peer                                                                                latest              b023f9be0771        3 months ago        187 MB
hyperledger/fabric-peer                                                                                x86_64-1.1.0        b023f9be0771        3 months ago        187 MB
hyperledger/fabric-javaenv                                                                             latest              82098abb1a17        3 months ago        1.52 GB
hyperledger/fabric-javaenv                                                                             x86_64-1.1.0        82098abb1a17        3 months ago        1.52 GB
hyperledger/fabric-ccenv                                                                               latest              c8b4909d8d46        3 months ago        1.39 GB
hyperledger/fabric-ccenv                                                                               x86_64-1.1.0        c8b4909d8d46        3 months ago        1.39 GB
hyperledger/fabric-zookeeper                                                                           latest              92cbb952b6f8        4 months ago        1.39 GB
hyperledger/fabric-zookeeper                                                                           x86_64-0.4.6        92cbb952b6f8        4 months ago        1.39 GB
hyperledger/fabric-kafka                                                                               latest              554c591b86a8        4 months ago        1.4 GB
hyperledger/fabric-kafka                                                                               x86_64-0.4.6        554c591b86a8        4 months ago        1.4 GB
hyperledger/fabric-couchdb                                                                             latest              7e73c828fc5b        4 months ago        1.56 GB
hyperledger/fabric-couchdb                                                                             x86_64-0.4.6        7e73c828fc5b        4 months ago        1.56 GB
hyperledger/fabric-baseos                                                                              x86_64-0.4.6        220e5cf3fb7f        4 months ago        151 MB

</code></pre>
</div>
<p>在linux系统下可以使用ps命令查看系统运行进程
如果在docker命令后面加入ps，构成如下docker ps命令则可以用此命令来查看docker容器下哪些镜像服务被启动，这些服务被启动可以理解为fabric网络中启动了哪些服务节点，也就是docker ps命令可以查看节点是否被启动</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker ps
CONTAINER ID        IMAGE                                                                                                  COMMAND                  CREATED             STATUS              PORTS                                              NAMES
1fa848b7ae68        dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab   "chaincode -peer.a..."   7 minutes ago       Up 7 minutes                                                           dev-peer1.org2.example.com-mycc-1.0
804b705886de        dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9   "chaincode -peer.a..."   7 minutes ago       Up 7 minutes                                                           dev-peer0.org1.example.com-mycc-1.0
a8904960eb15        dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b   "chaincode -peer.a..."   7 minutes ago       Up 7 minutes                                                           dev-peer0.org2.example.com-mycc-1.0
fed15e6c3487        hyperledger/fabric-tools:latest                                                                        "/bin/bash"              8 minutes ago       Up 8 minutes                                                           cli
c65eb8ff1389        hyperledger/fabric-peer:latest                                                                         "peer node start"        8 minutes ago       Up 8 minutes        0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp     peer1.org1.example.com
3e2cfc3b9c7a        hyperledger/fabric-peer:latest                                                                         "peer node start"        8 minutes ago       Up 8 minutes        0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp     peer0.org2.example.com
ddefb74476bd        hyperledger/fabric-orderer:latest                                                                      "orderer"                8 minutes ago       Up 8 minutes        0.0.0.0:7050-&gt;7050/tcp                             orderer.example.com
dcab205634e0        hyperledger/fabric-peer:latest                                                                         "peer node start"        8 minutes ago       Up 8 minutes        0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp   peer1.org2.example.com
1f502d394602        hyperledger/fabric-peer:latest                                                                         "peer node start"        8 minutes ago       Up 8 minutes        0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp     peer0.org1.example.com
</code></pre>
</div>
<p>从信息显示我们可以知道启动docker容器后，org1组织下的peer0和peer1节点以及org2下的peer0和peer1节点还有cli客户端节点服务被启动了</p>

<h3 id="关闭网络">关闭网络</h3>

<p><code class="highlighter-rouge">$ sudo ./byfn.sh -m down</code></p>

<p>关闭网络之后, 可以一步一步地探索网络设置. 杀死容器, 删除加密文件, 并从Docker Registry中删除链码图像</p>

<p>我们重新用sudo docker ps来查看</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</code></pre>
</div>
<p>可以看到之前启动网络是开启的服务节点全都关闭了</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker images
REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE
hyperledger/fabric-ca          latest              72617b4fa9b4        3 months ago        299 MB
hyperledger/fabric-ca          x86_64-1.1.0        72617b4fa9b4        3 months ago        299 MB
hyperledger/fabric-tools       latest              b7bfddf508bc        3 months ago        1.46 GB
hyperledger/fabric-tools       x86_64-1.1.0        b7bfddf508bc        3 months ago        1.46 GB
hyperledger/fabric-orderer     latest              ce0c810df36a        3 months ago        180 MB
hyperledger/fabric-orderer     x86_64-1.1.0        ce0c810df36a        3 months ago        180 MB
hyperledger/fabric-peer        latest              b023f9be0771        3 months ago        187 MB
hyperledger/fabric-peer        x86_64-1.1.0        b023f9be0771        3 months ago        187 MB
hyperledger/fabric-javaenv     latest              82098abb1a17        3 months ago        1.52 GB
hyperledger/fabric-javaenv     x86_64-1.1.0        82098abb1a17        3 months ago        1.52 GB
hyperledger/fabric-ccenv       latest              c8b4909d8d46        3 months ago        1.39 GB
hyperledger/fabric-ccenv       x86_64-1.1.0        c8b4909d8d46        3 months ago        1.39 GB
hyperledger/fabric-zookeeper   latest              92cbb952b6f8        4 months ago        1.39 GB
hyperledger/fabric-zookeeper   x86_64-0.4.6        92cbb952b6f8        4 months ago        1.39 GB
hyperledger/fabric-kafka       latest              554c591b86a8        4 months ago        1.4 GB
hyperledger/fabric-kafka       x86_64-0.4.6        554c591b86a8        4 months ago        1.4 GB
hyperledger/fabric-couchdb     latest              7e73c828fc5b        4 months ago        1.56 GB
hyperledger/fabric-couchdb     x86_64-0.4.6        7e73c828fc5b        4 months ago        1.56 GB
hyperledger/fabric-baseos      x86_64-0.4.6        220e5cf3fb7f        4 months ago        151 MB
</code></pre>
</div>

<p>若在启动网络时遇到如下错误</p>

<div class="highlighter-rouge"><pre class="highlight"><code>OCI runtime exec failed: exec failed: container_linux.go:348: starting container process caused "exec: \"scripts/script.sh\": stat scripts/script.sh: no such file or directory": unknown
</code></pre>
</div>

<p>或者</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ERROR: Encountered errors while bringing up the project.

ERROR !!!! Unable to start network
</code></pre>
</div>

<p>则执行<code class="highlighter-rouge">./byfn.sh down</code> 清除网络后再启动</p>

<h2 id="手动启动">手动启动</h2>
<h3 id="生成组织关系和身份证书">生成组织关系和身份证书</h3>
<p>先前我们采用自启动网络后生成的组织结构和身份证书文件是放在crypto-config这个包下，而相应的初始区块文件，通道配置交易文件，锚节点更新文件是放在channel-artifacts包下的。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd /hyfa/fabric-samples/first-network
$ pwd
/home/parallels/hyfa/fabric-samples/first-network
$ ll
总用量 108
drwxr-xr-x  7 root root  4096 Jun 20 18:01 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 20 18:01 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
drwxr-xr-x  4 root root  4096 Jun 20 18:01 crypto-config/
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3091 Jun 20 18:01 docker-compose-e2e.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/
</code></pre>
</div>
<p>我们需要执行关闭网络后方可再重新执行网络开启的命令</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ./byfn.sh -m down
[sudo] parallels 的密码：
Stopping with channel 'mychannel' and CLI timeout of '10' seconds and CLI delay of '3' seconds
Continue? [Y/n] y
proceeding ...
Stopping cli ... done
Stopping peer1.org1.example.com ... done
Stopping peer0.org1.example.com ... done
Stopping peer0.org2.example.com ... done
Stopping orderer.example.com ... done
Stopping peer1.org2.example.com ... done
Removing cli ... done
Removing peer1.org1.example.com ... done
Removing peer0.org1.example.com ... done
Removing peer0.org2.example.com ... done
Removing orderer.example.com ... done
Removing peer1.org2.example.com ... done
Removing network net_byfn
Removing volume net_peer0.org2.example.com
Removing volume net_peer1.org2.example.com
Removing volume net_peer1.org1.example.com
Removing volume net_peer0.org1.example.com
Removing volume net_orderer.example.com
Removing network net_byfn
WARNING: Network net_byfn not found.
Removing volume net_peer0.org2.example.com
WARNING: Volume net_peer0.org2.example.com not found.
Removing volume net_peer1.org2.example.com
WARNING: Volume net_peer1.org2.example.com not found.
Removing volume net_peer1.org1.example.com
WARNING: Volume net_peer1.org1.example.com not found.
Removing volume net_peer0.org1.example.com
WARNING: Volume net_peer0.org1.example.com not found.
Removing volume net_orderer.example.com
WARNING: Volume net_orderer.example.com not found.
a0975f403a52
b00a4f688a08
76127e178a59
Untagged: dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab:latest
Deleted: sha256:4386714a7ff3fc50e36eb7b7d4a6bb77237307439fda59e1528ebf0f773b7c93
Deleted: sha256:3cdcf6e605b6a1c4d06f67000ad46b46133a27e63171c03d1f6f6f389ab6671f
Deleted: sha256:0fd64f4ca5f5b1b5a4e6179a915c82d5e2ff3ca5754fb28f4f826c9c22c3a311
Deleted: sha256:94d03fb8a0c85c438ecaef3e36a413fd6e24c45b87a72bc9fd54ab669dc97421
Untagged: dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9:latest
Deleted: sha256:97e9f2a6be966b788b6dab07677cb79a2ad617e821a3735e8e5d4e55ae1d1379
Deleted: sha256:6cb8eb3651d60d23a048fb0e7e03ac6415052c8c3537c055fd054ae5d363c18d
Deleted: sha256:a232f57fed27e20235a53a34aa599a02181f58d3add196a452a5d607c1b77293
Deleted: sha256:697fb5505e49bb0e5fbd029e463ba6be13eea2a037efef25344f4ec89b001109
Untagged: dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b:latest
Deleted: sha256:6a5a1901c45e997ce90e660e8e3b286de7e9acd1e264b648e6543a261cefcf49
Deleted: sha256:64a3438793d1e707b32982a40e1da5dfeb760f03af68eca0c044761ffd947c3a
Deleted: sha256:32bb58cc650298bb3595aa49dfd421a4a26d94483dcbf23330e6a82600d2b016
Deleted: sha256:165cc7fcc70e224fc1c657cee896e9f764b16768efda4a32ab9e0e4fddc55764
</code></pre>
</div>
<p>我们来查看一下当前目录结构</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ll
总用量 100
drwxr-xr-x  6 root root  4096 Jun 27 16:13 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 27 16:13 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/
$ ll channel-artifacts/
总用量 8
drwxr-xr-x 2 root root 4096 Jun 27 16:13 ./
drwxr-xr-x 6 root root 4096 Jun 27 16:13 ../
-rw-r--r-- 1 root root    0 Jun 19 17:29 .gitkeep

</code></pre>
</div>
<p>可以发现crypto-config包没有了，但是channel-artifacts包还存在下面，不过channel-artifacts包下的初始区块文件，通道配置交易文件，锚节点更新文件被删除了，这说明当网络关闭后，fabric系统会自动把这些相关文件进行移除。</p>

<p>这里额外讲一下对系统权限修改的问题</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker images
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.26/images/json: dial unix /var/run/docker.sock: connect: permission denied
</code></pre>
</div>
<p>如上面显示的，我们执行docker命令的时候，每次都会因为权限问题导致操作系统拒绝执行docker命令，对此每次都需要在命令前面加上sudo，
docker容器被安装好后是被作为系统级别的程序而使用的， 只有系统root用户才能对其进行命令操作，那么怎么样才能让当前非root用户不需要通过在命令前加入sudo以表示赋予这个命令操作权限的方式来执行操作docker呢，而是直接让当前非root用户直接拥有对docker操作权限？我们可以通过对当前用户加权限的方式来解决。
通过如下命令：
<code class="highlighter-rouge">sudo usermod -aG docker 当前用户名</code>
具体如下：（我当前linux用户名是parallels）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo usermod -aG docker parallels
[sudo] parallels 的密码：
$ exit
</code></pre>
</div>
<p>这个命令表示的是将当前用户加入到能操作docker容器的角色组
执行完这个命令后需要退出当前终端后方可生效
（当然采用这种方式不一定有效，针对我当前所用的parallels Desktop虚拟机下的ubuntu16.04系统，这个命令并没有效果，如果没能达到效果，后面会再讲另一种方法）</p>

<p>我们继续讲用手动方式启动fabric网络</p>

<p>首先一定要确定是在  <code class="highlighter-rouge">fabric-samples/first-network</code>  路径下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd hyfa/fabric-samples/first-network/
</code></pre>
</div>

<p>为fabric网络生成指定拓扑结构的<strong>组织关系和身份证书</strong></p>

<p>这里使用的命令是在../bin/cryptogen的命令执行文件</p>

<p>我们可以查看一下这个命令具体使用及佩带的参数(查看工具命令帮助信息,我额外还加了一些注释)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ../bin/cryptogen --help
usage: cryptogen [&lt;flags&gt;] &lt;command&gt; [&lt;args&gt; ...]

Utility for generating Hyperledger Fabric key material

Flags:
  --help  Show context-sensitive help (also try --help-long and --help-man).

Commands: #这里显示cryptogen命令后面可以带有help和generate子命令
  help [&lt;command&gt;...]
    Show help.

  generate [&lt;flags&gt;] #这个子命令用于生成组织结构和身份证书
    Generate key material

  showtemplate   #表示依据所需要的模板配置文件 来生成组织结构和身份证书
    Show the default configuration template

  version #查看版本
    Show version information

  extend [&lt;flags&gt;] #拓展其他功能
    Extend existing network


</code></pre>
</div>
<p>我们再用如下命令查看</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen showtemplate
[sudo] parallels 的密码：

# ---------------------------------------------------------------------------
# "OrdererOrgs" - Definition of organizations managing orderer nodes
# ---------------------------------------------------------------------------
OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com

    # ---------------------------------------------------------------------------
    # "Specs" - See PeerOrgs below for complete description
    # ---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer

# ---------------------------------------------------------------------------
# "PeerOrgs" - Definition of organizations managing peer nodes
# ---------------------------------------------------------------------------
PeerOrgs:
  # ---------------------------------------------------------------------------
  # Org1
  # ---------------------------------------------------------------------------
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: false

    # ---------------------------------------------------------------------------
    # "CA"
    # ---------------------------------------------------------------------------
    # Uncomment this section to enable the explicit definition of the CA for this
    # organization.  This entry is a Spec.  See "Specs" section below for details.
    # ---------------------------------------------------------------------------
    # CA:
    #    Hostname: ca # implicitly ca.org1.example.com
    #    Country: US
    #    Province: California
    #    Locality: San Francisco
    #    OrganizationalUnit: Hyperledger Fabric
    #    StreetAddress: address for org # default nil
    #    PostalCode: postalCode for org # default nil

    # ---------------------------------------------------------------------------
    # "Specs"
    # ---------------------------------------------------------------------------
    # Uncomment this section to enable the explicit definition of hosts in your
    # configuration.  Most users will want to use Template, below
    #
    # Specs is an array of Spec entries.  Each Spec entry consists of two fields:
    #   - Hostname:   (Required) The desired hostname, sans the domain.
    #   - CommonName: (Optional) Specifies the template or explicit override for
    #                 the CN.  By default, this is the template:
    #
    #                              "."
    #
    #                 which obtains its values from the Spec.Hostname and
    #                 Org.Domain, respectively.
    #   - SANS:       (Optional) Specifies one or more Subject Alternative Names
    #                 to be set in the resulting x509. Accepts template
    #                 variables , , . IP
    #                 addresses provided here will be properly recognized. Other
    #                 values will be taken as DNS names.
    #                 NOTE: Two implicit entries are created for you:
    #                     - 
    #                     - 
    # ---------------------------------------------------------------------------
    # Specs:
    #   - Hostname: foo # implicitly "foo.org1.example.com"
    #     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above
    #     SANS:
    #       - "bar."
    #       - "altfoo."
    #       - ".org6.net"
    #       - 172.16.10.31
    #   - Hostname: bar
    #   - Hostname: baz

    # ---------------------------------------------------------------------------
    # "Template"
    # ---------------------------------------------------------------------------
    # Allows for the definition of 1 or more hosts that are created sequentially
    # from a template. By default, this looks like "peer%d" from 0 to Count-1.
    # You may override the number of nodes (Count), the starting index (Start)
    # or the template used to construct the name (Hostname).
    #
    # Note: Template and Specs are not mutually exclusive.  You may define both
    # sections and the aggregate nodes will be created for you.  Take care with
    # name collisions
    # ---------------------------------------------------------------------------
    Template:
      Count: 1
      # Start: 5
      # Hostname:  # default
      # SANS:
      #   - ".alt."

    # ---------------------------------------------------------------------------
    # "Users"
    # ---------------------------------------------------------------------------
    # Count: The number of user accounts _in addition_ to Admin
    # ---------------------------------------------------------------------------
    Users:
      Count: 1

  # ---------------------------------------------------------------------------
  # Org2: See "Org1" for full specification
  # ---------------------------------------------------------------------------
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: false
    Template:
      Count: 1
    Users:
      Count: 1
</code></pre>
</div>
<p>如上面所示，这里所列出的就是生成组织结构和身份证书所需要的以系列模板信息</p>

<p>上面的信息可以简化为如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>OrdererOrgs:

  - Name: Orderer #名称
    Domain: example.com #域名
    Specs:
      - Hostname: orderer #主机名称
    #组织全程就是：orderer.example.com

PeerOrgs:

  - Name: Org1 #第一个组织名称
    Domain: org1.example.com #域名
    EnableNodeOUs: false
    Template:
      Count: 1 #这里说明了在org1组织下的节点默认只有一个
    Users:
      Count: 1 #用户默认只有一个（这里的用户指的是有管理权限的管理员用户，可以对org1下peer节点进行管理）
    #全称：peer0.org1.example.com

  - Name: Org2 #第二个组织名称
    Domain: org2.example.com #域名
    EnableNodeOUs: false
    Template:
      Count: 1 #同样，在org2组织下的节点也只有一个
    Users:
      Count: 1 #用户也默认只有一个
    #全称：peer0.org2.example.com


</code></pre>
</div>
<p>很显然，上面用showtemplate子命令来显示的就是使用默认的模板的信息，以这个模板来生成的组织结构有两个，一个是Orderer的组织结构，一个是Peer的组织结构，而Peer下又分为org1和org2这两个组织，并且每个组织下默认只有一个peer节点
显然这样的组织结构不一定能够满足需求，这就需要指定自定义的模板结构，自定义的模板配置文件对应的文件路径是在fabric-smples/first-network/路径下的crypto-config.yaml文件，我们来查看这个配置文件
直接找到这个文件，双击文件打开或者在终端进入到这个路径下用vim命令打开，下面就是该配置文件的内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

# ---------------------------------------------------------------------------
# "OrdererOrgs" - Definition of organizations managing orderer nodes
# ---------------------------------------------------------------------------
OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com
    # ---------------------------------------------------------------------------
    # "Specs" - See PeerOrgs below for complete description
    # ---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer
# ---------------------------------------------------------------------------
# "PeerOrgs" - Definition of organizations managing peer nodes
# ---------------------------------------------------------------------------
PeerOrgs:
  # ---------------------------------------------------------------------------
  # Org1
  # ---------------------------------------------------------------------------
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    # ---------------------------------------------------------------------------
    # "Specs"
    # ---------------------------------------------------------------------------
    # Uncomment this section to enable the explicit definition of hosts in your
    # configuration.  Most users will want to use Template, below
    #
    # Specs is an array of Spec entries.  Each Spec entry consists of two fields:
    #   - Hostname:   (Required) The desired hostname, sans the domain.
    #   - CommonName: (Optional) Specifies the template or explicit override for
    #                 the CN.  By default, this is the template:
    #
    #                              "."
    #
    #                 which obtains its values from the Spec.Hostname and
    #                 Org.Domain, respectively.
    # ---------------------------------------------------------------------------
    # Specs:
    #   - Hostname: foo # implicitly "foo.org1.example.com"
    #     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above
    #   - Hostname: bar
    #   - Hostname: baz
    # ---------------------------------------------------------------------------
    # "Template"
    # ---------------------------------------------------------------------------
    # Allows for the definition of 1 or more hosts that are created sequentially
    # from a template. By default, this looks like "peer%d" from 0 to Count-1.
    # You may override the number of nodes (Count), the starting index (Start)
    # or the template used to construct the name (Hostname).
    #
    # Note: Template and Specs are not mutually exclusive.  You may define both
    # sections and the aggregate nodes will be created for you.  Take care with
    # name collisions
    # ---------------------------------------------------------------------------
    Template:
      Count: 2
      # Start: 5
      # Hostname:  # default
    # ---------------------------------------------------------------------------
    # "Users"
    # ---------------------------------------------------------------------------
    # Count: The number of user accounts _in addition_ to Admin
    # ---------------------------------------------------------------------------
    Users:
      Count: 1
  # ---------------------------------------------------------------------------
  # Org2: See "Org1" for full specification
  # ---------------------------------------------------------------------------
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2
    Users:
      Count: 1
</code></pre>
</div>
<p>同样我们对其内容进行简化，得出如下内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
OrdererOrgs:

  - Name: Orderer
    Domain: example.com
        Specs:
      - Hostname: orderer

PeerOrgs:

  - ame: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    Template: #指定Org1组织下的peer节点数量
      Count: 2   ers: #指定Org1组织下的管理员用户数量，这里会默认有一个名称叫Admin，此外还有名为User1的管理员用户，如果这里的1变成2，那么管理员用户名称则为User1和User2,更多的话则是名称User+依次递增的数字。
      Count: 1

  NameOrg2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template: #指定Org2组织下的peer节点数量
      Count: 2
    Users: #指定Org2组织下的管理员用户数量
      Count: 1
</code></pre>
</div>
<p>和我们默认的那个模板结构信息唯一不同的一点就是每个组织下的peer节点数量显示是2个，即Count: 2
也就是依据这个模板来生成的每个组织下的peer节点个数是2个。</p>

<p>我们再做进一步的查看，使用下面的命令查看generate的子命令</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --help
usage: cryptogen generate [&lt;flags&gt;]

Generate key material

Flags:
  --help                    Show context-sensitive help (also try --help-long
                            and --help-man).
  --output="crypto-config"  The output directory in which to place artifacts
  --config=CONFIG           The configuration template to use

</code></pre>
</div>
<p>参数说明：
–output：表示生成的文件指定输出保存到哪个路径下面，默认路径是在当前路径下生成一个crypto-config文件夹，并把所有的组织结构相关文件存在这个文件夹下面
–config：表示指定生成组织结构和身份证书所对应的模板配置文件及路径</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --config=./crypto-config.yaml
</code></pre>
</div>

<blockquote>
  <p>此命令依赖 <code class="highlighter-rouge">crypto-config.yaml</code> 配置文件</p>
</blockquote>

<p>会有如下输出:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --config=./crypto-config.yaml
org1.example.com
org2.example.com

</code></pre>
</div>
<p>此时再查看这个fabric-samples/first-network目录下的文件结构，可以发现生成多了一个名为crypto-config的文件包</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pwd
/home/parallels/hyfa/fabric-samples/first-network
$ ll
总用量 104
drwxr-xr-x  7 root root  4096 Jun 28 20:12 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 28 17:02 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
drwxr-xr-x  4 root root  4096 Jun 28 20:12 crypto-config/
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/
$ ll crypto-config/
总用量 16
drwxr-xr-x 4 root root 4096 Jun 28 20:12 ./
drwxr-xr-x 7 root root 4096 Jun 28 20:12 ../
drwxr-xr-x 3 root root 4096 Jun 28 20:12 ordererOrganizations/
drwxr-xr-x 4 root root 4096 Jun 28 20:12 peerOrganizations/

</code></pre>
</div>

<p>证书和密钥（即MSP材料）将被输出到目录  <code class="highlighter-rouge">first-network/crypto-config</code>  的目录中</p>

<p>ordererOrganizations子目录下包括构成Orderer组织(1个Orderer节点)的身份信息</p>

<p>peerOrganizations子目录下为所有的Peer节点组织(2个组织, 4个节点)的相关身份信息. 其中最关键的是MSP目录, 代表了实体的身份信息</p>

<p>我们可以使用tree命令来查看文件夹下的树形结构(需要先安装该命令)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree
程序“tree”尚未安装。 您可以使用以下命令安装：
sudo apt install tree
$ sudo apt install tree
[sudo] parallels 的密码：
正在读取软件包列表... 完成
正在分析软件包的依赖关系树 正在读取状态信息... 完成
包将被安装：
  tree
升级了 0 个软件包，新安装了 1 个软件包，要卸载 0 个软件包，有 40 个软件包未被升级。
需要下载 40.6 kB 的归档。
解压缩后会消耗 138 kB 的额外空间。
获取:1 http://cn.archive.ubuntu.com/ubuntu xenial/universe amd64 tree amd64 1.7.0-3 [40.6 kB]
已下载 40.6 kB，耗时 1秒 (30.4 kB/s)
正在选中未选择的软件包 tree。
(正在读取数据库 ... 系统当前共安装有 222889 个文件和目录。)
正准备解包 .../tree_1.7.0-3_amd64.deb  ...
正在解包 tree (1.7.0-3) ...
正在处理用于 man-db (2.7.5-1) 的触发器 ...
正在设置 tree (1.7.0-3) ...

</code></pre>
</div>

<p>接下来再使用如下命令<code class="highlighter-rouge">tree -L 4 crypto-config/ordererOrganizations</code>来查看crypto-config/ordererOrganizations文件夹下的树形结构，-L参数后面跟一个数字表示列出到第几级目录（即指定目录下的第几级目录），接着再加上所要查看的crypto-config/ordererOrganizations文件夹的树形结构</p>

<p>crypto-config/ordererOrganizations文件目录结构如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree -L 4 crypto-config/ordererOrganizations
crypto-config/ordererOrganizations
└── example.com
    ├── ca
    │   ├── 8d3798b19e109bffb6ccfd0af9c7518786b68fe632d8dd21ce2659d7f6de78ba_sk #orderer组织下的私钥文件
    │   └── ca.example.com-cert.pem #完整的ca证书文件
    ├── msp #成员服务提供
    │   ├── admincerts #管理员
    │   │   └── Admin@example.com-cert.pem #管理员证书
    │   ├── cacerts #与上面的ca证书文件一致，都是作为根证书使用
    │   │   └── ca.example.com-cert.pem
    │   └── tlscacerts #tls证书
    │       └── tlsca.example.com-cert.pem
    ├── orderers
    │   └── orderer.example.com
    │       ├── msp
    │       └── tls
    ├── tlsca #tls证书
    │   ├── eaa6faf31b45f42a93ce5571130a45c532d2b592ad1e15d76e738fde9851a095_sk #tls证书私钥文件
    │   └── tlsca.example.com-cert.pem
    └── users
        └── Admin@example.com
            ├── msp
            └── tls

15 directories, 7 files
</code></pre>
</div>
<p>这里有很多.pem后缀的文件，这些是证书文件，后期数据信息或者交易都依赖这些证书，还有就是.sk后缀结尾的文件都是密钥文件，用来存放私钥数据</p>

<p>我们再来看看crypto-config/peerOrganizations包下树形结构</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree -L 6 crypto-config/peerOrganizations
crypto-config/peerOrganizations
├── org1.example.com			# 第一个组织的相关材料，每个组织会生成单独的根证书
    │   ├── ca	#存放组织的根证书和对应的私钥文件，默认采用EC 算法，证书为自签名。组织内的实体将基于该根证书作为证书根。
    │   │   ├── 9b78dd1cc0570c9ef3f3fa31a1b343e7a6c0f157a2cc17f75412e12f2936898c_sk
    │   │   └── ca.org1.example.com-cert.pem
    │   ├── msp					# 存放代表该组织的身份信息
    │   │   ├── admincerts			# 组织管理员的身份验证证书，被根证书签名
    │   │   │   └── Admin@org1.example.com-cert.pem
    │   │   ├── cacerts				# 组织的根证书，同ca 目录下文件
    │   │   │   └── ca.org1.example.com-cert.pem
    │   │   ├── config.yaml
    │   │   └── tlscacerts			# 用于TLS 的CA 证书，自签名
    │   │       └── tlsca.org1.example.com-cert.pem
    │   ├── peers			      # 存放属于该组织的所有Peer 节点
    │   │   ├── peer0.org1.example.com	  # 第一个peer 的信息，包括其msp 证书和tls 证书两类
    │   │   │   ├── msp
    │   │   │   │   ├── admincerts # 组织管理员的身份验证证书。Peer 将基于这些证书来认证交易签署者是否为管理员身份
    │   │   │   │   ├── cacerts	  # 存放组织的根证书
    │   │   │   │   ├── config.yaml
    │   │   │   │   ├── keystore	  # 本节点的身份私钥，用来签名
    │   │   │   │   ├── signcerts	  # 验证本节点签名的证书，被组织根证书签名
    │   │   │   │   └── tlscacerts		# TLS 连接用的身份证书，即组织TLS 证书
    │   │   │   └── tls		             # 存放tls 相关的证书和私钥
    │   │   │       ├── ca.crt			# 组织的根证书
    │   │   │       ├── server.crt		# 验证本节点签名的证书，被组织根证书签名
    │   │   │       └── server.key		# 本节点的身份私钥，用来签名
    │   │   └── peer1.org1.example.com	# 第二个peer 的信息，与peer0.org1.example.com结构类似
    │   │       ├── msp
    │   │       │   ├── admincerts
    │   │       │   ├── cacerts
    │   │       │   ├── config.yaml
    │   │       │   ├── keystore
    │   │       │   ├── signcerts
    │   │       │   └── tlscacerts
    │   │       └── tls
    │   │           ├── ca.crt
    │   │           ├── server.crt
    │   │           └── server.key
    │   ├── tlsca
    │   │   ├── cf4587814bc05f9f81ac3d990c365660dedf1479e60f737c7e9e707727a27168_sk
    │   │   └── tlsca.org1.example.com-cert.pem
    │   └── users		                # 存放属于该组织的用户的实体
    │       ├── Admin@org1.example.com	# 管理员用户的信息，包括其msp 证书和tls 证书两类
    │       │   ├── msp
    │       │   │   ├── admincerts		# 管理身份验证证书
    │       │   │   ├── cacerts			# 存放组织的根证书
    │       │   │   ├── keystore			# 本用户的身份私钥，用来签名
    │       │   │   ├── signcerts			# 管理员用户的身份验证证书，被组织根证书签名。要被某个Peer认可，则必须放到该Peer 的msp/admincerts 下
    │       │   │   └── tlscacerts		# TLS 连接用的身份证书，即组织TLS 证书
    │       │   └── tls		             # 存放tls 相关的证书和私钥
    │       │       ├── ca.crt		   # 组织的根证书
    │       │       ├── client.crt		# 管理员的用户身份验证证书，被组织根证书签名
    │       │       └── client.key	   # 管理员用户的身份私钥，用来签名
    │       └── User1@org1.example.com	# 第一个用户的信息，包括msp 证书和tls 证书两类
    │           ├── msp
    │           │   ├── admincerts		# 管理身份验证证书
    │           │   ├── cacerts			# 存放组织的根证书
    │           │   ├── keystore			# 本用户的身份私钥，用来签名
    │           │   ├── signcerts		   # 验证本用户签名的身份证书，被组织根证书签名
    │           │   └── tlscacerts		# TLS 连接用的身份证书，即组织TLS 证书
    │           └── tls			          # 存放tls 相关的证书和私钥
    │               ├── ca.crt		   # 组织的根证书
    │               ├── client.crt		# 验证用户签名的身份证书，被组织根证书签名
    │               └── client.key		# 用户的身份私钥，用来签名
    └── org2.example.com				   # 第二个组织的信息，与org1.example.com结构类似
        ├── ca
        │   ├── 91fd76daf883a57066303fb6842ff4fb07c6793dbc8fbbca6303efea455884b2_sk
        │   └── ca.org2.example.com-cert.pem
        ├── msp
        │   ├── admincerts
        │   │   └── Admin@org2.example.com-cert.pem
        │   ├── cacerts
        │   │   └── ca.org2.example.com-cert.pem
        │   ├── config.yaml
        │   └── tlscacerts
        │       └── tlsca.org2.example.com-cert.pem
        ├── peers
        │   ├── peer0.org2.example.com
        │   │   ├── msp
        │   │   │   ├── admincerts
        │   │   │   ├── cacerts
        │   │   │   ├── config.yaml
        │   │   │   ├── keystore
        │   │   │   ├── signcerts
        │   │   │   └── tlscacerts
        │   │   └── tls
        │   │       ├── ca.crt
        │   │       ├── server.crt
        │   │       └── server.key
        │   └── peer1.org2.example.com
        │       ├── msp
        │       │   ├── admincerts
        │       │   ├── cacerts
        │       │   ├── config.yaml
        │       │   ├── keystore
        │       │   ├── signcerts
        │       │   └── tlscacerts
        │       └── tls
        │           ├── ca.crt
        │           ├── server.crt
        │           └── server.key
        ├── tlsca
        │   ├── d3c3e6e37d306992bc9fb826415ed77971031418db48c195d5a24521916f32f3_sk
        │   └── tlsca.org2.example.com-cert.pem
        └── users
            ├── Admin@org2.example.com
            │   ├── msp
            │   │   ├── admincerts
            │   │   ├── cacerts
            │   │   ├── keystore
            │   │   ├── signcerts
            │   │   └── tlscacerts
            │   └── tls
            │       ├── ca.crt
            │       ├── client.crt
            │       └── client.key
            └── User1@org2.example.com
                ├── msp
                │   ├── admincerts
                │   ├── cacerts
                │   ├── keystore
                │   ├── signcerts
                │   └── tlscacerts
                └── tls
                    ├── ca.crt
                    ├── client.crt
                    └── client.key

82 directories, 84 files
</code></pre>
</div>
<p>Cryptogen 按照配置文件中指定的结构生成了对应的组织和密钥、证书文件</p>

<p>其中最关键的是各个资源下的msp 目录内容，存储了生成的代表MSP 身份的各种证书文件，一般包括：</p>

<ul>
  <li>admincerts ：管理员的身份证书文件</li>
  <li>cacerts ：信任的根证书文件</li>
  <li>key store ：节点的签名私钥文件</li>
  <li>signcerts ：节点的签名身份证书文件</li>
  <li>tlscacerts: TLS 连接用的证书</li>
  <li>intermediatecerts （可选）：信任的中间证书</li>
  <li>crls （可选）：证书撤销列表</li>
  <li>config.yaml （可选）：记录OrganizationalUnitldentifiers 信息，包括根证书位置和ID信息</li>
</ul>

<p>这些身份文件随后可以分发到对应的Orderer 节点和Peer 节点上，并放到对应的MSP路径下，用于签名使用</p>

<p>如果你想让组织结构和身份证书能够按照自己的要求来生成，那么我们可以通过对crypto-config.yaml文件的编辑来改成满足自己的要求结构组织，然后删除之前生成的crypto-config文件夹，重新执行 <code class="highlighter-rouge">sudo ../bin/cryptogen generate --config=./crypto-config.yaml</code>命令来重新生成组织结构和证书</p>

<p>未避免忘记删除crypto-config文件夹就直接执行<code class="highlighter-rouge">sudo ../bin/cryptogen generate --config=./crypto-config.yaml</code>命令，我们先删除这个包，再来编辑crypto-config.yaml文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ rm -rf crypto-configrm: 无法删除'crypto-config/ordererOrganizations/example.com/ca/ca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/ca/8d3798b19e109bffb6ccfd0af9c7518786b68fe632d8dd21ce2659d7f6de78ba_sk': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/client.crt': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/tls/client.key': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/admincerts/Admin@example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/signcerts/Admin@example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/cacerts/ca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/tlscacerts/tlsca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/users/Admin@example.com/msp/keystore/7423346cd6ece6304b01f7aec2abd0c76ec730a16db58be548d0d17f27775b34_sk': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/tlsca/eaa6faf31b45f42a93ce5571130a45c532d2b592ad1e15d76e738fde9851a095_sk': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.crt': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.key': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/admincerts/Admin@example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/signcerts/orderer.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/cacerts/ca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp/keystore/d730d5eae88a4c6627c133e464395b13cdc48abbb72a19c3dcf67b1cb14b34b8_sk': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/msp/admincerts/Admin@example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/msp/cacerts/ca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/signcerts/peer0.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp/keystore/7b154572e88ba008e7381d54ca43b20df3ddd3b3c4f45c881a87716c17f8f4d2_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/signcerts/peer1.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp/keystore/e6f37874e45f95492d9be764078a4b59ca8c02455075bdbc2603e8bf2a250d4c_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/ca/c04b6d6d7c87b6d48dc6ed0df096c59abe17ca64dd6b2ff7664cdbf20b9db827_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/ca/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/client.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/tls/client.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/admincerts/User1@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/signcerts/User1@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp/keystore/173ec0ee4440895067e178c3f959243ff063a0ccd7412961134f19b56942b5f6_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/client.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/tls/client.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/signcerts/Admin@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/keystore/153d72f5f88d3bb1240dcedd8385f39725c16d6e76ec76d337a262a0b3711ec2_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/tlsca/43cdb9d10ceb96977332d6361363e9644cf58f14aec5b167c6b9ff5d830c0f92_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/tlsca/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/msp/admincerts/Admin@org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/msp/cacerts/ca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org2.example.com/msp/tlscacerts/tlsca.org2.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/signcerts/peer0.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp/keystore/55328660b97d294046ecf4f1e02e9689ee1708e1a3a80c2555e3fbd09a74b088_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/signcerts/peer1.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp/keystore/a37abe2e47aed1c6e1229f77fc8dd522b2baaf69b47302943590ee25fc104472_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/ca/0d11cc5383824860bb1ba8d2456cf470eb106f099526043cc56ee569f7120289_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/1f830770309aaddfe995a4b2d79f923de23593cbf00cc4097dc70bbf1c83b0d9_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/ca.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/client.crt': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/tls/client.key': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/admincerts/User1@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/4b6e64efa06e9cfa67be0977342578d249410df66b04581ee1a4482fb4b4c9c3_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/tlsca/5233caed511cf51b26868db7e5a160a4a547e1d27786206b654fbd7dbfc3f15d_sk': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/msp/admincerts/Admin@org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/msp/config.yaml': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/msp/cacerts/ca.org1.example.com-cert.pem': 权限不够
rm: 无法删除'crypto-config/peerOrganizations/org1.example.com/msp/tlscacerts/tlsca.org1.example.com-cert.pem': 权限不够

</code></pre>
</div>
<p>权限不够，要加上sudo</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo rm -rf crypto-config
[sudo] parallels 的密码：
$ ll
总用量 100
drwxr-xr-x  6 root root  4096 Jun 29 10:45 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 28 17:02 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
-rw-r--r--  1 root root  3906 Jun 19 17:29 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/

</code></pre>
</div>
<p>crypto-config文件夹已被删除</p>

<p>接着执行sudo vim crypto-config.yaml命令打开并编辑此文件内容
我们不妨把Count数值改成如下来看看效果</p>

<div class="highlighter-rouge"><pre class="highlight"><code>OrdererOrgs:

  - Name: Orderer
    Domain: example.com
        Specs:
      - Hostname: orderer

PeerOrgs:

  - ame: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    Template: #指定Org1组织下的peer节点数量
      Count: 5   ers: #指定Org1组织下的管理员用户数量，这里会默认有一个名称叫Admin，此外还有名为User1的管理员用户，如果这里的1变成2，那么管理员用户名称则为User1和User2,更多的话则是名称User+依次递增的数字。
      Count: 3

  NameOrg2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template: #指定Org2组织下的peer节点数量
      Count: 3
    Users: #指定Org2组织下的管理员用户数量
      Count: 2
</code></pre>
</div>
<p>编辑完后保存退出，再执行<code class="highlighter-rouge">sudo ../bin/cryptogen generate --config=./crypto-config.yaml</code>命令</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --config=./crypto-config.yaml
org1.example.com
org2.example.com
$ tree -L 4 crypto-config
crypto-config
├── ordererOrganizations
│   └── example.com
│       ├── ca
│       │   ├── 8bb69eff7e617fd72734a97389e8ae6f3cd50711194083155ee29860fde447b3_sk
│       │   └── ca.example.com-cert.pem
│       ├── msp
│       │   ├── admincerts
│       │   ├── cacerts
│       │   └── tlscacerts
│       ├── orderers
│       │   └── orderer.example.com
│       ├── tlsca
│       │   ├── dc99d1b004e8587dea95ef0ba3d44e3a2a58753d1cba8890d3a1b5d4b83a66dd_sk
│       │   └── tlsca.example.com-cert.pem
│       └── users
│           └── Admin@example.com
└── peerOrganizations
    ├── org1.example.com
    │   ├── ca
    │   │   ├── 1b1d797c9751e5094d2735b008252b58a2f2478a542bea1b46c6ad5ec8429774_sk
    │   │   └── ca.org1.example.com-cert.pem
    │   ├── msp
    │   │   ├── admincerts
    │   │   ├── cacerts
    │   │   ├── config.yaml
    │   │   └── tlscacerts
    │   ├── peers  #可以看到这里列出了5个peer节点
    │   │   ├── peer0.org1.example.com
    │   │   ├── peer1.org1.example.com
    │   │   ├── peer2.org1.example.com
    │   │   ├── peer3.org1.example.com
    │   │   └── peer4.org1.example.com
    │   ├── tlsca
    │   │   ├── 04f5c6b0e8bb7d3c143fd5ea4a3a3627c03692318332bef18f7cfbe1ef7b22a5_sk
    │   │   └── tlsca.org1.example.com-cert.pem
    │   └── users  #管理员用户列出了4个，其中以User开头为名称的有3个，说明之前的修改模板信息里的Users的Counts数值是对应以User开头为名称的个数
    │       ├── Admin@org1.example.com #额外多一个默认的名为Admin的管理员
    │       ├── User1@org1.example.com #除了默认的Admin管理员,还生成多三个管理员用户，User1,User2和User3
    │       ├── User2@org1.example.com
    │       └── User3@org1.example.com
    └── org2.example.com
        ├── ca
        │   ├── 028a7a35c30170912096aa1414614dcf7daf2269632bb47f7a67901a048fb963_sk
        │   └── ca.org2.example.com-cert.pem
        ├── msp
        │   ├── admincerts
        │   ├── cacerts
        │   ├── config.yaml
        │   └── tlscacerts
        ├── peers  #这里列出了3个peer节点
        │   ├── peer0.org2.example.com
        │   ├── peer1.org2.example.com
        │   └── peer2.org2.example.com
        ├── tlsca
        │   ├── a777c6810bd2ba6acb8137b8f8a6d9fb2e087a943b4231af4ae57d6845d45c2a_sk
        │   └── tlsca.org2.example.com-cert.pem
        └── users  #管理员用户列出了3个，其中以User开头为名称的有2个
            ├── Admin@org2.example.com
            ├── User1@org2.example.com
            └── User2@org2.example.com

46 directories, 14 files

</code></pre>
</div>
<p>这里可以通过修改模板文件中的定下的peer节点数量和管理员用户数量来达到增加或减少节点数量和管理员用户数量，从而改变其结构组织</p>

<p>此外还可以增加或减少org组织数量，只需要在crypto-config.yaml模板文件里增加或减少如下内容即可(注意组织名称要改变)</p>

<div class="highlighter-rouge"><pre class="highlight"><code> - Name: Org3
    Domain: org3.example.com
    EnableNodeOUs: true
    Template: #指定Org3组织下的peer节点数量
      Count: 2
    Users: #指定Org3组织下的管理员用户数量
      Count: 1
</code></pre>
</div>
<p>执行<code class="highlighter-rouge">sudo ../bin/cryptogen generate --config=./crypto-config.yaml</code>命令后生成组织结构树形图如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --config=./crypto-config.yaml
org1.example.com
org2.example.com
org3.example.com
$ tree -L 4 crypto-config
crypto-config
├── ordererOrganizations
│   └── example.com
│       ├── ca
│       │   ├── 6846abfcf2e64933193fb472b30464d7976e2a4df44fb75ee40a1b9ac2ca7a55_sk
│       │   └── ca.example.com-cert.pem
│       ├── msp
│       │   ├── admincerts
│       │   ├── cacerts
│       │   └── tlscacerts
│       ├── orderers
│       │   └── orderer.example.com
│       ├── tlsca
│       │   ├── 8d50e867dbeef169f5c6a0cba0a2b133f336581d7ec1dfac9d4a553a7fbb0a38_sk
│       │   └── tlsca.example.com-cert.pem
│       └── users
│           └── Admin@example.com
└── peerOrganizations
    ├── org1.example.com
    │   ├── ca
    │   │   ├── ca.org1.example.com-cert.pem
    │   │   └── efdd6825a1c15e5833269921471aeee8aef384fa16be44b374a68951be196359_sk
    │   ├── msp
    │   │   ├── admincerts
    │   │   ├── cacerts
    │   │   ├── config.yaml
    │   │   └── tlscacerts
    │   ├── peers
    │   │   ├── peer0.org1.example.com
    │   │   └── peer1.org1.example.com
    │   ├── tlsca
    │   │   ├── 9b4fb430f19469a102361760fa6b3ee158df8a5ce8e55cb351c5f474a719641c_sk
    │   │   └── tlsca.org1.example.com-cert.pem
    │   └── users
    │       ├── Admin@org1.example.com
    │       └── User1@org1.example.com
    ├── org2.example.com
    │   ├── ca
    │   │   ├── 0fa0a39ace18b039c0bb871dba90954fb3aabb7db8ae91063bcf021646b39412_sk
    │   │   └── ca.org2.example.com-cert.pem
    │   ├── msp
    │   │   ├── admincerts
    │   │   ├── cacerts
    │   │   ├── config.yaml
    │   │   └── tlscacerts
    │   ├── peers
    │   │   ├── peer0.org2.example.com
    │   │   └── peer1.org2.example.com
    │   ├── tlsca
    │   │   ├── 7ca8ca7d39331e71007d25a881394e6e3956d6c1eedd8eb7b4ec8c14045757c0_sk
    │   │   └── tlsca.org2.example.com-cert.pem
    │   └── users
    │       ├── Admin@org2.example.com
    │       └── User1@org2.example.com
    └── org3.example.com #这个是增加的组织，名为org3
        ├── ca
        │   ├── b53734114a81a1c6acf84ca36fe0952dbeeb5ec8c54a562c55a7383f1d264b3c_sk
        │   └── ca.org3.example.com-cert.pem
        ├── msp
        │   ├── admincerts
        │   ├── cacerts
        │   ├── config.yaml
        │   └── tlscacerts
        ├── peers
        │   ├── peer0.org3.example.com
        │   └── peer1.org3.example.com
        ├── tlsca
        │   ├── 805c1e3812a03c92c27823509653755f2a4a2f0a0929d131a99110075bc830bd_sk
        │   └── tlsca.org3.example.com-cert.pem
        └── users
            ├── Admin@org3.example.com
            └── User1@org3.example.com

52 directories, 19 files

</code></pre>
</div>

<p>需要注意的是，在当前一台机器下搭建的fabric网络环境是不可以有两个orderer组织的，就比如你想通过将模板文件内容增加如下内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code>- Name: Orderer2
    Domain: example.com
        Specs:
      - Hostname: orderer2
</code></pre>
</div>

<p>来改成这样</p>

<div class="highlighter-rouge"><pre class="highlight"><code>OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer1
    Domain: example.com
    # ---------------------------------------------------------------------------
    # "Specs" - See PeerOrgs below for complete description
    # ---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer1
# ---------------------------------------------------------------------------

  - Name: Orderer2
    Domain: example.com
        Specs:
      - Hostname: orderer2
</code></pre>
</div>

<p>以求增加orderer组织数量是不可行的，在执行<code class="highlighter-rouge">sudo ../bin/cryptogen generate --config=./crypto-config.yaml</code>命令会报如下错误</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/cryptogen generate --config=./crypto-config.yaml
Error reading config: Error Unmarshaling YAML: yaml: line 23: mapping values are not allowed in this context
</code></pre>
</div>
<p>orderer组织只能有一个，但是组织下可以有多个orderer节点(集群)</p>

<p>一个节点可以是一台服务器主机构成，也可以是一台通用计算机构成，还可以是多台计算机或者多台服务器主机构成的集群。</p>

<h3 id="配置环境变量">配置环境变量</h3>
<p>告诉configtxgen工具在哪里寻找configtx.yaml 文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export FABRIC_CFG_PATH=$PWD
</code></pre>
</div>
<h3 id="创建ordering服务启动初始区块">创建Ordering服务启动初始区块</h3>

<p>指定使用  <code class="highlighter-rouge">configtx.yaml</code>  文件中定义的  <code class="highlighter-rouge">TwoOrgsOrdererGenesis</code>  模板, 生成Ordering服务系统通道的初始区块文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ export FABRIC_CFG_PATH=$PWD
$ sudo ../bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block
[sudo] parallels 的密码：
2018-06-29 14:34:13.106 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-29 14:34:13.113 CST [msp] getMspConfig -&gt; INFO 002 Loading NodeOUs
2018-06-29 14:34:13.113 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs
2018-06-29 14:34:13.113 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 004 Generating genesis block
2018-06-29 14:34:13.114 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 005 Writing genesis block
</code></pre>
</div>
<p>查看当前channel-artifacts文件夹下文件，会发现生成多一个genesis.block文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ll ./channel-artifacts/
总用量 24
drwxr-xr-x 2 root root  4096 Jun 29 14:34 ./
drwxr-xr-x 7 root root  4096 Jun 29 14:17 ../
-rw-r--r-- 1 root root 12643 Jun 29 14:34 genesis.block
-rw-r--r-- 1 root root     0 Jun 19 17:29 .gitkeep
</code></pre>
</div>
<h3 id="创建一个应用通道的配置交易文件">创建一个应用通道的配置交易文件</h3>

<p>务必替换$CHANNEL_NAME或设置CHANNEL_NAME为可在整个说明中使用的环境变量（定义一个环境变量，这个变量只有在当前终端下有效，关闭此终端后，此变量就失效）</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export CHANNEL_NAME=mychannel
</code></pre>
</div>

<p>指定使用  <code class="highlighter-rouge">configtx.yaml</code>  配置文件中的  <code class="highlighter-rouge">TwoOrgsChannel</code>  模板, 来生成新建通道的配置交易文件,  <code class="highlighter-rouge">TwoOrgsChannel</code>  模板指定了Org1和Org2都属于后面新建的应用通道</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
</code></pre>
</div>
<p>参数说明：
-profile： 指定应用通道的配置交易文件模板
-outputCreateChannelTx：指定生成的文件存放的路径
-channelID： 指定生成的通道名称</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export CHANNEL_NAME=mychannel
$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
[sudo] parallels 的密码：
2018-06-29 15:16:41.769 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-29 15:16:41.780 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx
2018-06-29 15:16:41.781 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs
2018-06-29 15:16:41.782 CST [msp] getMspConfig -&gt; INFO 004 Loading NodeOUs
2018-06-29 15:16:41.806 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Writing new channel tx

</code></pre>
</div>
<p>再次查看当前channel-artifacts文件夹下文件，会发现生成又多一个channel.tx文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ll ./channel-artifacts/总用量 28
drwxr-xr-x 2 root root  4096 Jun 29 15:16 ./
drwxr-xr-x 7 root root  4096 Jun 29 14:17 ../
-rw-r--r-- 1 root root   346 Jun 29 15:16 channel.tx
-rw-r--r-- 1 root root 12643 Jun 29 14:34 genesis.block
-rw-r--r-- 1 root root     0 Jun 19 17:29 .gitkeep

</code></pre>
</div>

<h3 id="生成锚节点配置更新文件">生成锚节点配置更新文件</h3>

<p>锚节点配置更新文件用来对组织的锚节点进行配置</p>

<p>同样基于  <code class="highlighter-rouge">configtx.yaml</code>  配置文件生成新建通道文件, 每个组织都需要分别生成且注意指定对应的组织名称</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
2018-06-29 15:30:53.698 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-29 15:30:53.707 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2018-06-29 15:30:53.707 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update
$ sudo ../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
2018-06-29 15:31:31.396 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration
2018-06-29 15:31:31.411 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update
2018-06-29 15:31:31.412 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update
$ ll ./channel-artifacts/
总用量 36
drwxr-xr-x 2 root root  4096 Jun 29 15:31 ./
drwxr-xr-x 7 root root  4096 Jun 29 14:17 ../
-rw-r--r-- 1 root root   346 Jun 29 15:16 channel.tx
-rw-r--r-- 1 root root 12643 Jun 29 14:34 genesis.block
-rw-r--r-- 1 root root     0 Jun 19 17:29 .gitkeep
-rw-r--r-- 1 root root   284 Jun 29 15:30 Org1MSPanchors.tx
-rw-r--r-- 1 root root   284 Jun 29 15:31 Org2MSPanchors.tx
</code></pre>
</div>

<p>由于命令参数众多，在这种情况下，可以使用帮助命令来辅助查看命令参数</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo ../bin/configtxgen --help
[sudo] parallels 的密码：
Usage of ../bin/configtxgen:
  -asOrg string #参数-asOrg后面指定哪个peer组织的id
    	Performs the config generation as a particular organization (by name), only including values in the write set that org (likely) has privilege to set
  -channelID string
    	The channel ID to use in the configtx (default "testchainid")
  -inspectBlock string
    	Prints the configuration contained in the block at the specified path
  -inspectChannelCreateTx string
    	Prints the configuration contained in the transaction at the specified path
  -outputAnchorPeersUpdate string
    	Creates an config update to update an anchor peer (works only with the default channel creation, and only for the first update)
  -outputBlock string
    	The path to write the genesis block to (if set)
  -outputCreateChannelTx string
    	The path to write a channel creation configtx to (if set)
  -printOrg string
    	Prints the definition of an organization as JSON. (useful for adding an org to a channel manually)
  -profile string     	The profile from configtx.yaml to use for generation. (default "SampleInsecureSolo")
  -version
    	Show version information
</code></pre>
</div>
<p>前面生成创世区块文件，应用通道配置交易文件，锚节点配置更新文件都是依据configtx.yaml文件中定义的  <code class="highlighter-rouge">TwoOrgsOrdererGenesis</code>， <code class="highlighter-rouge">TwoOrgsChannel</code>  模板，这里我们对configtx.yaml文件内容做个了解。
可以用vim打开这个configtx.yaml配置文件，其内容如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code> # Copyright IBM Corp. All Rights Reserved.
#
 # SPDX-License-Identifier: Apache-2.0
#

---
################################################################################
#
 #   Profile
#
 #   - Different configuration profiles may be encoded here to be specified
 #   as parameters to the configtxgen tool
#
################################################################################
Profiles:

    TwoOrgsOrdererGenesis: #指定创世区块配置
        Capabilities:
            &lt;&lt;: *ChannelCapabilities
        Orderer:
            &lt;&lt;: *OrdererDefaults
            Organizations:
                - *OrdererOrg  #指定orderer的组织名称
            Capabilities:
                &lt;&lt;: *OrdererCapabilities
        Consortiums:           #指定联盟
            SampleConsortium:
                Organizations:
                    - *Org1
                    - *Org2
    TwoOrgsChannel: #指定通道配置
        Consortium: SampleConsortium
        Application:
            &lt;&lt;: *ApplicationDefaults
            Organizations: #指定当前通道加入的组织
                - *Org1
                - *Org2
            Capabilities:
                &lt;&lt;: *ApplicationCapabilities

################################################################################
#
 #   Section: Organizations
#
 #   - This section defines the different organizational identities which will
 #   be referenced later in the configuration.
#
################################################################################
Organizations:

    # SampleOrg defines an MSP using the sampleconfig.  It should never be used
    # in production but may be used as a template for other definitions
    - &amp;OrdererOrg
        # DefaultOrg defines the organization which is used in the sampleconfig
        # of the fabric.git development environment
        Name: OrdererOrg

        # ID to load the MSP definition as
        ID: OrdererMSP

        # MSPDir is the filesystem path which contains the MSP configuration
        #指定orderer的MSP本地路径
        MSPDir: crypto-config/ordererOrganizations/example.com/msp

    - &amp;Org1
        # DefaultOrg defines the organization which is used in the sampleconfig
        # of the fabric.git development environment
        Name: Org1MSP

        # ID to load the MSP definition as
        ID: Org1MSP

        MSPDir: crypto-config/peerOrganizations/org1.example.com/msp

        AnchorPeers:
            # AnchorPeers defines the location of peers which can be used
            # for cross org gossip communication.  Note, this value is only
            # encoded in the genesis block in the Application section context
            - Host: peer0.org1.example.com
              Port: 7051

    - &amp;Org2
        # DefaultOrg defines the organization which is used in the sampleconfig
        # of the fabric.git development environment
        Name: Org2MSP

        # ID to load the MSP definition as
        ID: Org2MSP

        MSPDir: crypto-config/peerOrganizations/org2.example.com/msp

        AnchorPeers:
            # AnchorPeers defines the location of peers which can be used
            # for cross org gossip communication.  Note, this value is only
            # encoded in the genesis block in the Application section context
            - Host: peer0.org2.example.com
              Port: 7051

################################################################################
#
 #   SECTION: Orderer
#
 #   - This section defines the values to encode into a config transaction or
 #   genesis block for orderer related parameters
#
################################################################################
Orderer: &amp;OrdererDefaults

    # Orderer Type: The orderer implementation to start
    # Available types are "solo" and "kafka"
    OrdererType: solo

    Addresses:
        - orderer.example.com:7050

    # Batch Timeout: The amount of time to wait before creating a batch
    BatchTimeout: 2s

    # Batch Size: Controls the number of messages batched into a block
    BatchSize:

        # Max Message Count: The maximum number of messages to permit in a batch
        MaxMessageCount: 10

        # Absolute Max Bytes: The absolute maximum number of bytes allowed for
        # the serialized messages in a batch.
        AbsoluteMaxBytes: 99 MB

        # Preferred Max Bytes: The preferred maximum number of bytes allowed for
        # the serialized messages in a batch. A message larger than the preferred
        # max bytes will result in a batch larger than preferred max bytes.
        PreferredMaxBytes: 512 KB

    Kafka:
        # Brokers: A list of Kafka brokers to which the orderer connects
        # NOTE: Use IP:port notation
        Brokers:
            - 127.0.0.1:9092

    # Organizations is the list of orgs which are defined as participants on
    # the orderer side of the network
    Organizations:

################################################################################
#
 #   SECTION: Application
#
 #   - This section defines the values to encode into a config transaction or
 #   genesis block for application related parameters
#
################################################################################
Application: &amp;ApplicationDefaults

    # Organizations is the list of orgs which are defined as participants on
    # the application side of the network
    Organizations:

################################################################################
#
 #   SECTION: Capabilities
#
 #   - This section defines the capabilities of fabric network. This is a new
 #   concept as of v1.1.0 and should not be utilized in mixed networks with
 #   v1.0.x peers and orderers.  Capabilities define features which must be
 #   present in a fabric binary for that binary to safely participate in the
 #   fabric network.  For instance, if a new MSP type is added, newer binaries
 #   might recognize and validate the signatures from this type, while older
 #   binaries without this support would be unable to validate those
 #   transactions.  This could lead to different versions of the fabric binaries
 #   having different world states.  Instead, defining a capability for a channel
 #   informs those binaries without this capability that they must cease
 #   processing transactions until they have been upgraded.  For v1.0.x if any
 #   capabilities are defined (including a map with all capabilities turned off)
 #   then the v1.0.x peer will deliberately crash.
#
################################################################################
Capabilities:
    # Channel capabilities apply to both the orderers and the peers and must be
    # supported by both.  Set the value of the capability to true to require it.
    Global: &amp;ChannelCapabilities
        # V1.1 for Global is a catchall flag for behavior which has been
        # determined to be desired for all orderers and peers running v1.0.x,
        # but the modification of which would cause incompatibilities.  Users
        # should leave this flag set to true.
        V1_1: true

    # Orderer capabilities apply only to the orderers, and may be safely
    # manipulated without concern for upgrading peers.  Set the value of the
    # capability to true to require it.
    Orderer: &amp;OrdererCapabilities
        # V1.1 for Order is a catchall flag for behavior which has been
        # determined to be desired for all orderers running v1.0.x, but the
        # modification of which  would cause incompatibilities.  Users should
        # leave this flag set to true.
        V1_1: true

    # Application capabilities apply only to the peer network, and may be safely
    # manipulated without concern for upgrading orderers.  Set the value of the
    # capability to true to require it.
    Application: &amp;ApplicationCapabilities
        # V1.1 for Application is a catchall flag for behavior which has been
        # determined to be desired for all peers running v1.0.x, but the
        # modification of which would cause incompatibilities.  Users should
        # leave this flag set to true.
        V1_1: true

</code></pre>
</div>

<p>比较多，去掉注释，简化成如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
Profiles:

    TwoOrgsOrdererGenesis: #指定创世区块配置
        Capabilities:
            &lt;&lt;: *ChannelCapabilities
        Orderer:
            &lt;&lt;: *OrdererDefaults
            Organizations:
                - *OrdererOrg  #指定orderer的组织名称
            Capabilities:
                &lt;&lt;: *OrdererCapabilities
        Consortiums:           #指定联盟
            SampleConsortium:
                Organizations:
                    - *Org1
                    - *Org2
    TwoOrgsChannel: #指定通道配置
        Consortium: SampleConsortium
        Application:
            &lt;&lt;: *ApplicationDefaults
            Organizations: #指定当前通道加入的组织
                - *Org1
                - *Org2
            Capabilities:
                &lt;&lt;: *ApplicationCapabilities

Organizations: #组织的相关信息有哪些

    - &amp;OrdererOrg

        Name: OrdererOrg

        ID: OrdererMSP

        #指定orderer的MSP本地路径
        MSPDir: crypto-config/ordererOrganizations/example.com/msp

    - &amp;Org1

        Name: Org1MSP

        ID: Org1MSP #org1组织的id

        MSPDir: crypto-config/peerOrganizations/org1.example.com/msp

        AnchorPeers: 在这里锚节点是指点下来的，不是通过选举产生的
            - Host: peer0.org1.example.com #这里已指定org1下的peer0节点为锚节点
              Port: 7051

    - &amp;Org2
         Name: Org2MSP

        ID: Org2MSP #org2组织的id

        MSPDir: crypto-config/peerOrganizations/org2.example.com/msp

        AnchorPeers:
            - Host: peer0.org2.example.com #这里已指定org2下的peer0节点为锚节点
              Port: 7051

Orderer: &amp;OrdererDefaults #这里定义的是跟区块相关的内容

	 # Orderer Type: The orderer implementation to start
    # Available types are "solo" and "kafka"
    #这里的注释也写明了orderer组织类型可以是这么两种：solo和kafka
    #solo是一种针对测试阶段采用的组织模式，也就是单节点模式，而实际生产环境，则采用kafka模式，搭建一种集群环境，也就是多节点模式
    OrdererType: solo

    Addresses: #指定地址
        - orderer.example.com:7050

    BatchTimeout: 2s #给定超时时间2秒（处理一批消息的超时时间）

    BatchSize: #这里是指定区块大小

        MaxMessageCount: 10 #指定能够处理信息数据的个数
         AbsoluteMaxBytes: 99 MB #指定一个区块最大容量

       edMaxBytes: 512 KB #建议区块中单个信息数据的大小不超过512KB（知识建议，如果单个信息数据大小超过最大值，也可以生成区块,但是不允许超过99MB）

    Kafka: #下面是你如果选择kafka模式，对应的地址
        Brokers:
            - 127.0.0.1:9092 #配置kafka,一般是搭建集群，多台服务器主机使用的端口号应该要是一致的，保证所有服务器主机端口号一致

    Organizations:

Application: &amp;ApplicationDefaults

    Organizations:

Capabilities:

   bal: &amp;Channeabilities
    1: true
 Orderer: &amp;OrdererCapabiliti
    1
    pli&amp;ApplicionCapilities
   V1_1:
</code></pre>
</div>
<h3 id="启动网络-1">启动网络</h3>

<p>先前我们通过命令生成了四个配置文件，这四个配置文件相对于测试环境来讲有两个暂时是可以忽略的，这两个是Org1MSPahchors.tx和Org2MSPahchors.tx</p>

<p>接下来我们启动网络，命令如下：</p>

<p><code class="highlighter-rouge">$ sudo docker-compose -f docker-compose-cli.yaml up -d</code></p>

<p>-f:  指定docker-compose文件（这个文件是启动容器时使用对应的配置文件，这个配置文件中配置了相应节点的服务信息)</p>

<p>我们查看docker-compose-cli.yaml的内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code> # Copyright IBM Corp. All Rights Reserved.
 #
 # SPDX-License-Identifier: Apache-2.0
 #

version: '2'

volumes:
  orderer.example.com:
  peer0.org1.example.com:
  peer1.org1.example.com:
  peer0.org2.example.com:
  peer1.org2.example.com:

networks:
  byfn:

services: #服务

  orderer.example.com: #orderer组织提供的服务
    extends: #拓展功能
      file:   base/docker-compose-base.yaml #这个是依据的配置文件路径
      service: orderer.example.com
    container_name: orderer.example.com
    networks:
      - byfn

  peer0.org1.example.com:
    container_name: peer0.org1.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org1.example.com
    networks:
      - byfn

  peer1.org1.example.com:
    container_name: peer1.org1.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer1.org1.example.com
    networks:
      - byfn

  peer0.org2.example.com:
    container_name: peer0.org2.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer0.org2.example.com
    networks:
      - byfn

  peer1.org2.example.com:
    container_name: peer1.org2.example.com
    extends:
      file:  base/docker-compose-base.yaml
      service: peer1.org2.example.com
    networks:
      - byfn

  cli:
    container_name: cli
    image: hyperledger/fabric-tools:$IMAGE_TAG
    tty: true
    stdin_open: true
    environment:
      - GOPATH=/opt/gopath
      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock
      #- CORE_LOGGING_LEVEL=DEBUG
      - CORE_LOGGING_LEVEL=INFO
      - CORE_PEER_ID=cli
      - CORE_PEER_ADDRESS=peer0.org1.example.com:7051
      - CORE_PEER_LOCALMSPID=Org1MSP
      - CORE_PEER_TLS_ENABLED=true
      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt
      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key
      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer
    command: /bin/bash
    volumes:
        - /var/run/:/host/var/run/
        - ./../chaincode/:/opt/gopath/src/github.com/chaincode
        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/
        - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/
        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts
    depends_on:
      - orderer.example.com
      - peer0.org1.example.com
      - peer1.org1.example.com
      - peer0.org2.example.com
      - peer1.org2.example.com
    networks:
      - byfn
</code></pre>
</div>
<p><code class="highlighter-rouge">sudo docker-compose -f docker-compose-cli.yaml up -d</code>命令执行过程显示的一系列信息日志就是你在配置文件中申明的各种节点的启动服务信息，这些日志显示了其启动过程具体做了哪些工作，主机和docker容器之间做了哪些映射，而这些映射就在上述docker-compose-cli.yaml配置文件内容中记录的拓展项（extends）里指定路径下（file:  base/docker-compose-base.yaml）的配置文件里作了声明。</p>

<p>同样，我们需要查看其base/docker-compose-base.yaml这个配置文件的内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pwd
/home/parallels/hyfa/fabric-samples/first-network
$ ll base
总用量 20
drwxr-xr-x 2 root root 4096 Jun 19 17:29 ./
drwxr-xr-x 7 root root 4096 Jun 29 14:17 ../
-rw-r--r-- 1 root root 4659 Jun 19 17:29 docker-compose-base.yaml
-rw-r--r-- 1 root root 1015 Jun 19 17:29 peer-base.yaml

</code></pre>
</div>
<p>base/docker-compose-base.yaml这个配置文件的内容如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code># Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  orderer.example.com:
    container_name: orderer.example.com
    image: hyperledger/fabric-orderer:$IMAGE_TAG
    environment: #这里可以看成是对orderer环境变量配置
      - ORDERER_GENERAL_LOGLEVEL=INFO
      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0
      - ORDERER_GENERAL_GENESISMETHOD=file
      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block
      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP
      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp
      # enabled TLS
      - ORDERER_GENERAL_TLS_ENABLED=true
      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key
      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt
      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]
    working_dir: /opt/gopath/src/github.com/hyperledger/fabric
    command: orderer
    volumes:
    - ../channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block
    - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp
    - ../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls
    - orderer.example.com:/var/hyperledger/production/orderer
    ports:
      - 7050:7050

  peer0.org1.example.com:
    container_name: peer0.org1.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment: #这里可以看成是对peer0.org1环境变量配置
      - CORE_PEER_ID=peer0.org1.example.com
      - CORE_PEER_ADDRESS=peer0.org1.example.com:7051
      - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org1.example.com:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051
      - CORE_PEER_LOCALMSPID=Org1MSP
    volumes:
        - /var/run/:/host/var/run/
        - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp
        - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls
        - peer0.org1.example.com:/var/hyperledger/production
    ports:
      - 7051:7051
      - 7053:7053

  peer1.org1.example.com:
    container_name: peer1.org1.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment: #这里可以看成是对peer1.org1环境变量配置
      - CORE_PEER_ID=peer1.org1.example.com
      - CORE_PEER_ADDRESS=peer1.org1.example.com:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.com:7051
      - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.com:7051
      - CORE_PEER_LOCALMSPID=Org1MSP
    volumes:
        - /var/run/:/host/var/run/
        - ../crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp:/etc/hyperledger/fabric/msp
        - ../crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls:/etc/hyperledger/fabric/tls
        - peer1.org1.example.com:/var/hyperledger/production

    ports:
      - 8051:7051
      - 8053:7053

  peer0.org2.example.com:
    container_name: peer0.org2.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment: #这里可以看成是对peer0.org2环境变量配置
      - CORE_PEER_ID=peer0.org2.example.com
      - CORE_PEER_ADDRESS=peer0.org2.example.com:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051
      - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.com:7051
      - CORE_PEER_LOCALMSPID=Org2MSP
    volumes: #挂载
        - /var/run/:/host/var/run/ #主机和容器之间的一个映射
        - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp
        - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls
        - peer0.org2.example.com:/var/hyperledger/production
    ports:
      - 9051:7051
      - 9053:7053

  peer1.org2.example.com:
    container_name: peer1.org2.example.com
    extends:
      file: peer-base.yaml
      service: peer-base
    environment: #这里可以看成是对peer1.org2环境变量配置
      - CORE_PEER_ID=peer1.org2.example.com
      - CORE_PEER_ADDRESS=peer1.org2.example.com:7051
      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com:7051
      - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051
      - CORE_PEER_LOCALMSPID=Org2MSP
    volumes:
        - /var/run/:/host/var/run/
        # ../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp这个是指定org2的peer1节点的msp在主机上的路径，/etc/hyperledger/fabric/msp是docker容器里下的某个路径，:是映射
        - ../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp:/etc/hyperledger/fabric/msp
        - ../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls:/etc/hyperledger/fabric/tls
        - peer1.org2.example.com:/var/hyperledger/production
    ports:
      - 10051:7051
      - 10053:7053
</code></pre>
</div>
<p>注:</p>

<p>如果想查看网络的具体实时日志，则不需要提供 -d 参数，如果想忽略这些日志信息（不想打印输出详细的内容），那么就加上-d参数</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker-compose -f docker-compose-cli.yaml up -d
[sudo] parallels 的密码：
Creating network "net_byfn" with the default driver
Creating volume "net_peer0.org2.example.com" with default driver
Creating volume "net_peer1.org2.example.com" with default driver
Creating volume "net_peer1.org1.example.com" with default driver
Creating volume "net_peer0.org1.example.com" with default driver
Creating volume "net_orderer.example.com" with default driver
Creating orderer.example.com
Creating peer0.org2.example.com
Creating peer0.org1.example.com
Creating peer1.org2.example.com
Creating peer1.org1.example.com
Creating cli
</code></pre>
</div>
<p>下面是命令里没有-d参数显示的完整信息日志</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo docker-compose -f docker-compose-cli.yaml up
$ sudo docker-compose -f docker-compose-cli.yaml up
[sudo] parallels 的密码：
Creating network "net_byfn" with the default driver
Creating peer0.org1.example.com
Creating peer0.org2.example.com
Creating orderer.example.com
Creating peer1.org2.example.com
Creating peer1.org1.example.com
Creating cli
Attaching to peer1.org2.example.com, peer0.org1.example.com, peer0.org2.example.com, peer1.org1.example.com, orderer.example.com, cli
peer1.org2.example.com    | 2018-07-02 08:45:57.773 UTC [msp] getMspConfig -&gt; INFO 001 Loading NodeOUs
peer1.org2.example.com    | 2018-07-02 08:45:57.793 UTC [nodeCmd] serve -&gt; INFO 002 Starting peer:
peer1.org2.example.com    |  Version: 1.1.0
peer0.org1.example.com    | 2018-07-02 08:45:57.771 UTC [msp] getMspConfig -&gt; INFO 001 Loading NodeOUs
peer0.org1.example.com    | 2018-07-02 08:45:57.795 UTC [nodeCmd] serve -&gt; INFO 002 Starting peer:
peer0.org1.example.com    |  Version: 1.1.0
peer0.org1.example.com    |  Go version: go1.9.2
peer0.org1.example.com    |  OS/Arch: linux/amd64
peer0.org1.example.com    |  Experimental features: false
peer0.org1.example.com    |  Chaincode:
peer0.org1.example.com    |   Base Image Version: 0.4.6
peer0.org1.example.com    |   Base Docker Namespace: hyperledger
peer0.org1.example.com    |   Base Docker Label: org.hyperledger.fabric
peer0.org1.example.com    |   Docker Namespace: hyperledger
peer0.org1.example.com    | peer0.org1.example.com    | 2018-07-02 08:45:57.795 UTC [ledgermgmt] initialize -&gt; INFO 003 Initializing ledger mgmt
peer0.org1.example.com    | 2018-07-02 08:45:57.795 UTC [kvledger] NewProvider -&gt; INFO 004 Initializing ledger provider
peer0.org1.example.com    | 2018-07-02 08:45:57.827 UTC [kvledger] NewProvider -&gt; INFO 005 ledger provider Initialized
peer0.org2.example.com    | 2018-07-02 08:45:57.840 UTC [msp] getMspConfig -&gt; INFO 001 Loading NodeOUs
peer1.org2.example.com    |  Go version: go1.9.2
peer0.org1.example.com    | 2018-07-02 08:45:57.827 UTC [ledgermgmt] initialize -&gt; INFO 006 ledger mgmt initialized
peer1.org1.example.com    | 2018-07-02 08:45:58.704 UTC [msp] getMspConfig -&gt; INFO 001 Loading NodeOUs
peer1.org1.example.com    | 2018-07-02 08:45:58.722 UTC [nodeCmd] serve -&gt; INFO 002 Starting peer:
peer1.org1.example.com    |  Version: 1.1.0
peer1.org1.example.com    |  Go version: go1.9.2
peer1.org1.example.com    |  OS/Arch: linux/amd64
peer1.org1.example.com    |  Experimental features: false
peer1.org1.example.com    |  Chaincode:
orderer.example.com       | 2018-07-02 08:45:59.791 UTC [orderer/common/server] prettyPrintStruct -&gt; INFO 001 Orderer config values:
peer0.org1.example.com    | 2018-07-02 08:45:57.827 UTC [peer] func1 -&gt; INFO 007 Auto-detected peer address: 172.18.0.2:7051
peer0.org2.example.com    | 2018-07-02 08:45:57.875 UTC [nodeCmd] serve -&gt; INFO 002 Starting peer:
peer1.org1.example.com    |   Base Image Version: 0.4.6
peer1.org1.example.com    |   Base Docker Namespace: hyperledger
peer1.org2.example.com    |  OS/Arch: linux/amd64
peer1.org2.example.com    |  Experimental features: false
peer1.org1.example.com    |   Base Docker Label: org.hyperledger.fabric
orderer.example.com       | 	General.LedgerType = "file"
orderer.example.com       | 	General.ListenAddress = "0.0.0.0"
orderer.example.com       | 	General.ListenPort = 7050
peer0.org1.example.com    | 2018-07-02 08:45:57.828 UTC [peer] func1 -&gt; INFO 008 Returning peer0.org1.example.com:7051
peer1.org1.example.com    |   Docker Namespace: hyperledger
peer1.org1.example.com    |
eer1.org2.example.com    |  Chaincode:
peer1.org2.example.com    |   Base Image Version: 0.4.6
peer0.org1.example.com    | 2018-07-02 08:45:57.828 UTC [peer] func1 -&gt; INFO 009 Auto-detected peer address: 172.18.0.2:7051
peer0.org2.example.com    |  Version: 1.1.0
peer1.org1.example.com    | 2018-07-02 08:45:58.722 UTC [ledgermgmt] initialize -&gt; INFO 003 Initializing ledger mgmt
peer1.org1.example.com    | 2018-07-02 08:45:58.722 UTC [kvledger] NewProvider -&gt; INFO 004 Initializing ledger provider
peer0.org1.example.com    | 2018-07-02 08:45:57.828 UTC [peer] func1 -&gt; INFO 00a Returning peer0.org1.example.com:7051
peer1.org2.example.com    |   Base Docker Namespace: hyperledger
orderer.example.com       | 	General.TLS.Enabled = true
orderer.example.com       | 	General.TLS.PrivateKey = "/var/hyperledger/orderer/tls/server.key"
orderer.example.com       | 	General.TLS.Certificate = "/var/hyperledger/orderer/tls/server.crt"
orderer.example.com       | 	General.TLS.RootCAs = [/var/hyperledger/orderer/tls/ca.crt]
orderer.example.com       | 	General.TLS.ClientAuthRequired = false
orderer.example.com       | 	General.TLS.ClientRootCAs = []
orderer.example.com       | 	General.Keepalive.ServerMinInterval = 1m0s
orderer.example.com       | 	General.Keepalive.ServerInterval = 2h0m0s
orderer.example.com       | 	General.Keepalive.ServerTimeout = 20s
orderer.example.com       | 	General.GenesisMethod = "file"
orderer.example.com       | 	General.GenesisProfile = "SampleInsecureSolo"
orderer.example.com       | 	General.SystemChannel = "testchainid"
orderer.example.com       | 	General.GenesisFile = "/var/hyperledger/orderer/orderer.genesis.block"
orderer.example.com       | 	General.Profile.Enabled = false
orderer.example.com       | 	General.Profile.Address = "0.0.0.0:6060"
orderer.example.com       | 	General.LogLevel = "INFO"
orderer.example.com       | 	General.LogFormat = "%{color}%{time:2006-01-02 15:04:05.000 MST} [%{module}] %{shortfunc} -&gt; %{level:.4s} %{id:03x}%{color:reset} %{message}"
orderer.example.com       | 	General.LocalMSPDir = "/var/hyperledger/orderer/msp"
orderer.example.com       | 	General.LocalMSPID = "OrdererMSP"
orderer.example.com       | 	General.BCCSP.ProviderName = "SW"
orderer.example.com       | 	General.BCCSP.SwOpts.SecLevel = 256
orderer.example.com       | 	General.BCCSP.SwOpts.HashFamily = "SHA2"
orderer.example.com       | 	General.BCCSP.SwOpts.Ephemeral = false
orderer.example.com       | 	General.BCCSP.SwOpts.FileKeystore.KeyStorePath = "/var/hyperledger/orderer/msp/keystore"
orderer.example.com       | 	General.BCCSP.SwOpts.DummyKeystore =
orderer.example.com       | 	General.BCCSP.PluginOpts =
orderer.example.com       | 	General.BCCSP.Pkcs11Opts =
orderer.example.com       | 	General.Authentication.TimeWindow = 15m0s
orderer.example.com       | 	FileLedger.Location = "/var/hyperledger/production/orderer"
orderer.example.com       | 	FileLedger.Prefix = "hyperledger-fabric-ordererledger"
peer0.org1.example.com    | 2018-07-02 08:45:57.832 UTC [nodeCmd] serve -&gt; INFO 00b Starting peer with TLS enabled
peer0.org1.example.com    | 2018-07-02 08:45:57.835 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00c Entering computeChaincodeEndpoint with peerHostname: peer0.org1.example.com
peer0.org1.example.com    | 2018-07-02 08:45:57.835 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00d Exit with ccEndpoint: peer0.org1.example.com:7052
peer0.org1.example.com    | 2018-07-02 08:45:57.835 UTC [nodeCmd] createChaincodeServer -&gt; WARN 00e peer.chaincodeListenAddress is not set, using peer0.org1.example.com:7052
peer0.org1.example.com    | 2018-07-02 08:45:57.836 UTC [eventhub_producer] start -&gt; INFO 00f Event processor started
peer1.org1.example.com    | 2018-07-02 08:45:58.738 UTC [kvledger] NewProvider -&gt; INFO 005 ledger provider Initialized
peer0.org1.example.com    | 2018-07-02 08:45:57.844 UTC [chaincode] NewChaincodeSupport -&gt; INFO 010 Chaincode support using peerAddress: peer0.org1.example.com:7052
peer1.org1.example.com    | 2018-07-02 08:45:58.739 UTC [ledgermgmt] initialize -&gt; INFO 006 ledger mgmt initialized
peer0.org1.example.com    | 2018-07-02 08:45:57.845 UTC [sccapi] registerSysCC -&gt; INFO 011 system chaincode cscc(github.com/hyperledger/fabric/core/scc/cscc) registered
peer1.org1.example.com    | 2018-07-02 08:45:58.739 UTC [peer] func1 -&gt; INFO 007 Auto-detected peer address: 172.18.0.3:7051
peer1.org2.example.com    |   Base Docker Label: org.hyperledger.fabric
orderer.example.com       | 	RAMLedger.HistorySize = 1000
peer0.org2.example.com    |  Go version: go1.9.2
peer1.org1.example.com    | 2018-07-02 08:45:58.739 UTC [peer] func1 -&gt; INFO 008 Returning peer1.org1.example.com:7051
peer0.org1.example.com    | 2018-07-02 08:45:57.846 UTC [sccapi] registerSysCC -&gt; INFO 012 system chaincode lscc(github.com/hyperledger/fabric/core/scc/lscc) registered
peer0.org1.example.com    | 2018-07-02 08:45:57.847 UTC [sccapi] registerSysCC -&gt; INFO 013 system chaincode escc(github.com/hyperledger/fabric/core/scc/escc) registered
peer0.org1.example.com    | 2018-07-02 08:45:57.848 UTC [sccapi] registerSysCC -&gt; INFO 014 system chaincode vscc(github.com/hyperledger/fabric/core/scc/vscc) registered
peer0.org1.example.com    | 2018-07-02 08:45:57.848 UTC [sccapi] registerSysCC -&gt; INFO 015 system chaincode qscc(github.com/hyperledger/fabric/core/chaincode/qscc) registered
peer1.org2.example.com    |   Docker Namespace: hyperledger
peer1.org2.example.com    | per1.org2.example.com    | 2018-07-02 08:45:57.793 UTC [ledgermgmt] initialize -&gt; INFO 003 Initializing ledger mgmt
peer1.org2.example.com    | 2018-07-02 08:45:57.793 UTC [kvledger] NewProvider -&gt; INFO 004 Initializing ledger provider
peer0.org1.example.com    | 2018-07-02 08:45:57.853 UTC [gossip/service] func1 -&gt; INFO 016 Initialize gossip with endpoint peer0.org1.example.com:7051 and bootstrap set [peer1.org1.example.com:7051]
peer1.org1.example.com    | 2018-07-02 08:45:58.739 UTC [peer] func1 -&gt; INFO 009 Auto-detected peer address: 172.18.0.3:7051
peer0.org1.example.com    | 2018-07-02 08:45:57.856 UTC [msp] DeserializeIdentity -&gt; INFO 017 Obtaining identity
peer1.org2.example.com    | 2018-07-02 08:45:57.844 UTC [kvledger] NewProvider -&gt; INFO 005 ledger provider Initialized
peer1.org2.example.com    | 2018-07-02 08:45:57.844 UTC [ledgermgmt] initialize -&gt; INFO 006 ledger mgmt initialized
peer1.org1.example.com    | 2018-07-02 08:45:58.739 UTC [peer] func1 -&gt; INFO 00a Returning peer1.org1.example.com:7051
orderer.example.com       | 	Kafka.Retry.ShortInterval = 5s
orderer.example.com       | 	Kafka.Retry.ShortTotal = 10m0s
orderer.example.com       | 	Kafka.Retry.LongInterval = 5m0s
orderer.example.com       | 	Kafka.Retry.LongTotal = 12h0m0s
orderer.example.com       | 	Kafka.Retry.NetworkTimeouts.DialTimeout = 10s
orderer.example.com       | 	Kafka.Retry.NetworkTimeouts.ReadTimeout = 10s
orderer.example.com       | 	Kafka.Retry.NetworkTimeouts.WriteTimeout = 10s
orderer.example.com       | 	Kafka.Retry.Metadata.RetryMax = 3
orderer.example.com       | 	Kafka.Retry.Metadata.RetryBackoff = 250ms
orderer.example.com       | 	Kafka.Retry.Producer.RetryMax = 3
orderer.example.com       | 	Kafka.Retry.Producer.RetryBackoff = 100ms
orderer.example.com       | 	Kafka.Retry.Consumer.RetryBackoff = 2s
orderer.example.com       | 	Kafka.Verbose = false
orderer.example.com       | 	Kafka.Version = 0.10.2.0
orderer.example.com       | 	Kafka.TLS.Enabled = false
orderer.example.com       | 	Kafka.TLS.PrivateKey = ""
orderer.example.com       | 	Kafka.TLS.Certificate = ""
orderer.example.com       | 	Kafka.TLS.RootCAs = []
orderer.example.com       | 	Kafka.TLS.ClientAuthRequired = false
orderer.example.com       | 	Kafka.TLS.ClientRootCAs = []
orderer.example.com       | 	Debug.BroadcastTraceDir = ""
orderer.example.com       | 	Debug.DeliverTraceDir = ""
peer1.org1.example.com    | 2018-07-02 08:45:58.741 UTC [nodeCmd] serve -&gt; INFO 00b Starting peer with TLS enabled
peer0.org1.example.com    | 2018-07-02 08:45:57.858 UTC [gossip/discovery] NewDiscoveryService -&gt; INFO 018 Started {peer0.org1.example.com:7051 [] [239 98 230 139 194 189 7 52 237 46 97 253 2 67 212 179 13 153 166 47 213 56 41 238 143 16 233 50 243 134 40 200] peer0.org1.example.com:7051 &lt;nil&gt;} incTime is 1530521157858737734
peer1.org2.example.com    | 2018-07-02 08:45:57.844 UTC [peer] func1 -&gt; INFO 007 Auto-detected peer address: 172.18.0.5:7051
peer1.org2.example.com    | 2018-07-02 08:45:57.845 UTC [peer] func1 -&gt; INFO 008 Returning peer1.org2.example.com:7051
peer0.org1.example.com    | 2018-07-02 08:45:57.861 UTC [gossip/gossip] NewGossipService -&gt; INFO 019 Creating gossip service with self membership of {peer0.org1.example.com:7051 [] [239 98 230 139 194 189 7 52 237 46 97 253 2 67 212 179 13 153 166 47 213 56 41 238 143 16 233 50 243 134 40 200] peer0.org1.example.com:7051 &lt;nil&gt;}
peer1.org1.example.com    | 2018-07-02 08:45:58.742 UTC [eventhub_producer] start -&gt; INFO 00c Event processor started
peer0.org1.example.com    | 2018-07-02 08:45:57.863 UTC [gossip/gossip] start -&gt; INFO 01a Gossip instance peer0.org1.example.com:7051 started
peer1.org2.example.com    | 2018-07-02 08:45:57.845 UTC [peer] func1 -&gt; INFO 009 Auto-detected peer address: 172.18.0.5:7051
peer1.org1.example.com    | 2018-07-02 08:45:58.742 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00d Entering computeChaincodeEndpoint with peerHostname: peer1.org1.example.com
peer1.org2.example.com    | 2018-07-02 08:45:57.845 UTC [peer] func1 -&gt; INFO 00a Returning peer1.org2.example.com:7051
peer0.org1.example.com    | 2018-07-02 08:45:57.869 UTC [cscc] Init -&gt; INFO 01b Init CSCC
peer1.org1.example.com    | 2018-07-02 08:45:58.743 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00e Exit with ccEndpoint: peer1.org1.example.com:7052
orderer.example.com       | 2018-07-02 08:45:59.793 UTC [orderer/common/server] initializeServerConfig -&gt; INFO 002 Starting orderer with TLS enabled
peer1.org2.example.com    | 2018-07-02 08:45:57.848 UTC [nodeCmd] serve -&gt; INFO 00b Starting peer with TLS enabled
peer0.org1.example.com    | 2018-07-02 08:45:57.869 UTC [sccapi] deploySysCC -&gt; INFO 01c system chaincode cscc/(github.com/hyperledger/fabric/core/scc/cscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.743 UTC [nodeCmd] createChaincodeServer -&gt; WARN 00f peer.chaincodeListenAddress is not set, using peer1.org1.example.com:7052
peer1.org2.example.com    | 2018-07-02 08:45:57.850 UTC [eventhub_producer] start -&gt; INFO 00c Event processor started
orderer.example.com       | 2018-07-02 08:45:59.804 UTC [orderer/common/server] initializeMultichannelRegistrar -&gt; INFO 003 Not bootstrapping because of existing chains
peer0.org1.example.com    | 2018-07-02 08:45:57.870 UTC [sccapi] deploySysCC -&gt; INFO 01d system chaincode lscc/(github.com/hyperledger/fabric/core/scc/lscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.745 UTC [chaincode] NewChaincodeSupport -&gt; INFO 010 Chaincode support using peerAddress: peer1.org1.example.com:7052
peer0.org1.example.com    | 2018-07-02 08:45:57.872 UTC [escc] Init -&gt; INFO 01e Successfully initialized ESCC
orderer.example.com       | 2018-07-02 08:45:59.814 UTC [orderer/commmon/multichannel] NewRegistrar -&gt; INFO 004 Starting system channel 'testchainid' with genesis block hash 2051cc736e997f1632debf07d4b475eade2dd625970f6d276a4de990155efe86 and orderer type solo
orderer.example.com       | 2018-07-02 08:45:59.815 UTC [orderer/common/server] Start -&gt; INFO 005 Starting orderer:
orderer.example.com       |  Version: 1.1.0
orderer.example.com       |  Go version: go1.9.2
orderer.example.com       |  OS/Arch: linux/amd64
orderer.example.com       |  Experimental features: false
orderer.example.com       | 2018-07-02 08:45:59.815 UTC [orderer/common/server] Start -&gt; INFO 006 Beginning to serve requests
peer1.org2.example.com    | 2018-07-02 08:45:57.850 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00d Entering computeChaincodeEndpoint with peerHostname: peer1.org2.example.com
peer1.org1.example.com    | 2018-07-02 08:45:58.745 UTC [sccapi] registerSysCC -&gt; INFO 011 system chaincode cscc(github.com/hyperledger/fabric/core/scc/cscc) registered
peer1.org1.example.com    | 2018-07-02 08:45:58.745 UTC [sccapi] registerSysCC -&gt; INFO 012 system chaincode lscc(github.com/hyperledger/fabric/core/scc/lscc) registered
peer1.org2.example.com    | 2018-07-02 08:45:57.850 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00e Exit with ccEndpoint: peer1.org2.example.com:7052
peer0.org1.example.com    | 2018-07-02 08:45:57.872 UTC [sccapi] deploySysCC -&gt; INFO 01f system chaincode escc/(github.com/hyperledger/fabric/core/scc/escc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.746 UTC [sccapi] registerSysCC -&gt; INFO 013 system chaincode escc(github.com/hyperledger/fabric/core/scc/escc) registered
peer1.org2.example.com    | 2018-07-02 08:45:57.850 UTC [nodeCmd] createChaincodeServer -&gt; WARN 00f peer.chaincodeListenAddress is not set, using peer1.org2.example.com:7052
peer0.org1.example.com    | 2018-07-02 08:45:57.873 UTC [sccapi] deploySysCC -&gt; INFO 020 system chaincode vscc/(github.com/hyperledger/fabric/core/scc/vscc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [chaincode] NewChaincodeSupport -&gt; INFO 010 Chaincode support using peerAddress: peer1.org2.example.com:7052
peer1.org1.example.com    | 2018-07-02 08:45:58.746 UTC [sccapi] registerSysCC -&gt; INFO 014 system chaincode vscc(github.com/hyperledger/fabric/core/scc/vscc) registered
peer1.org1.example.com    | 2018-07-02 08:45:58.746 UTC [sccapi] registerSysCC -&gt; INFO 015 system chaincode qscc(github.com/hyperledger/fabric/core/chaincode/qscc) registered
peer1.org1.example.com    | 2018-07-02 08:45:58.747 UTC [gossip/service] func1 -&gt; INFO 016 Initialize gossip with endpoint peer1.org1.example.com:7051 and bootstrap set [peer0.org1.example.com:7051]
peer1.org1.example.com    | 2018-07-02 08:45:58.748 UTC [msp] DeserializeIdentity -&gt; INFO 017 Obtaining identity
peer1.org1.example.com    | 2018-07-02 08:45:58.750 UTC [gossip/discovery] NewDiscoveryService -&gt; INFO 018 Started {peer1.org1.example.com:7051 [] [210 226 66 202 4 204 46 65 57 202 131 22 158 159 176 227 33 227 221 137 209 128 203 107 24 213 154 80 252 199 121 37] peer1.org1.example.com:7051 &lt;nil&gt;} incTime is 1530521158749813791
peer1.org1.example.com    | 2018-07-02 08:45:58.750 UTC [gossip/gossip] NewGossipService -&gt; INFO 019 Creating gossip service with self membership of {peer1.org1.example.com:7051 [] [210 226 66 202 4 204 46 65 57 202 131 22 158 159 176 227 33 227 221 137 209 128 203 107 24 213 154 80 252 199 121 37] peer1.org1.example.com:7051 &lt;nil&gt;}
peer1.org1.example.com    | 2018-07-02 08:45:58.751 UTC [gossip/gossip] start -&gt; INFO 01a Gossip instance peer1.org1.example.com:7051 started
peer1.org1.example.com    | 2018-07-02 08:45:58.753 UTC [cscc] Init -&gt; INFO 01b Init CSCC
peer1.org1.example.com    | 2018-07-02 08:45:58.753 UTC [sccapi] deploySysCC -&gt; INFO 01c system chaincode cscc/(github.com/hyperledger/fabric/core/scc/cscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.754 UTC [sccapi] deploySysCC -&gt; INFO 01d system chaincode lscc/(github.com/hyperledger/fabric/core/scc/lscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.754 UTC [escc] Init -&gt; INFO 01e Successfully initialized ESCC
peer1.org1.example.com    | 2018-07-02 08:45:58.754 UTC [sccapi] deploySysCC -&gt; INFO 01f system chaincode escc/(github.com/hyperledger/fabric/core/scc/escc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [sccapi] registerSysCC -&gt; INFO 011 system chaincode cscc(github.com/hyperledger/fabric/core/scc/cscc) registered
peer0.org1.example.com    | 2018-07-02 08:45:57.873 UTC [qscc] Init -&gt; INFO 021 Init QSCC
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [sccapi] registerSysCC -&gt; INFO 012 system chaincode lscc(github.com/hyperledger/fabric/core/scc/lscc) registered
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [sccapi] registerSysCC -&gt; INFO 013 system chaincode escc(github.com/hyperledger/fabric/core/scc/escc) registered
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [sccapi] registerSysCC -&gt; INFO 014 system chaincode vscc(github.com/hyperledger/fabric/core/scc/vscc) registered
peer1.org2.example.com    | 2018-07-02 08:45:57.852 UTC [sccapi] registerSysCC -&gt; INFO 015 system chaincode qscc(github.com/hyperledger/fabric/core/chaincode/qscc) registered
peer0.org1.example.com    | 2018-07-02 08:45:57.873 UTC [sccapi] deploySysCC -&gt; INFO 022 system chaincode qscc/(github.com/hyperledger/fabric/core/chaincode/qscc) deployed
peer0.org1.example.com    | 2018-07-02 08:45:57.873 UTC [nodeCmd] initSysCCs -&gt; INFO 023 Deployed system chaincodes
peer0.org1.example.com    | 2018-07-02 08:45:57.873 UTC [nodeCmd] serve -&gt; INFO 024 Starting peer with ID=[name:"peer0.org1.example.com" ], network ID=[dev], address=[peer0.org1.example.com:7051]
peer0.org1.example.com    | 2018-07-02 08:45:57.874 UTC [nodeCmd] serve -&gt; INFO 025 Started peer with ID=[name:"peer0.org1.example.com" ], network ID=[dev], address=[peer0.org1.example.com:7051]
peer1.org2.example.com    | 2018-07-02 08:45:57.853 UTC [gossip/service] func1 -&gt; INFO 016 Initialize gossip with endpoint peer1.org2.example.com:7051 and bootstrap set [peer0.org2.example.com:7051]
peer0.org1.example.com    | 2018-07-02 08:45:57.875 UTC [nodeCmd] func7 -&gt; INFO 026 Starting profiling server with listenAddress = 0.0.0.0:6060
peer1.org2.example.com    | 2018-07-02 08:45:57.854 UTC [msp] DeserializeIdentity -&gt; INFO 017 Obtaining identity
peer1.org2.example.com    | 2018-07-02 08:45:57.856 UTC [gossip/discovery] NewDiscoveryService -&gt; INFO 018 Started {peer1.org2.example.com:7051 [] [184 95 210 205 234 253 19 19 255 176 119 142 250 223 118 247 95 25 197 147 101 148 47 67 225 171 185 33 92 112 40 122] peer1.org2.example.com:7051 &lt;nil&gt;} incTime is 1530521157856668222
peer1.org1.example.com    | 2018-07-02 08:45:58.755 UTC [sccapi] deploySysCC -&gt; INFO 020 system chaincode vscc/(github.com/hyperledger/fabric/core/scc/vscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.756 UTC [qscc] Init -&gt; INFO 021 Init QSCC
peer1.org1.example.com    | 2018-07-02 08:45:58.756 UTC [sccapi] deploySysCC -&gt; INFO 022 system chaincode qscc/(github.com/hyperledger/fabric/core/chaincode/qscc) deployed
peer1.org1.example.com    | 2018-07-02 08:45:58.756 UTC [nodeCmd] initSysCCs -&gt; INFO 023 Deployed system chaincodes
peer1.org1.example.com    | 2018-07-02 08:45:58.756 UTC [nodeCmd] serve -&gt; INFO 024 Starting peer with ID=[name:"peer1.org1.example.com" ], network ID=[dev], address=[peer1.org1.example.com:7051]
peer1.org1.example.com    | 2018-07-02 08:45:58.756 UTC [nodeCmd] serve -&gt; INFO 025 Started peer with ID=[name:"peer1.org1.example.com" ], network ID=[dev], address=[peer1.org1.example.com:7051]
peer1.org1.example.com    | 2018-07-02 08:45:58.757 UTC [nodeCmd] func7 -&gt; INFO 026 Starting profiling server with listenAddress = 0.0.0.0:6060
peer1.org2.example.com    | 2018-07-02 08:45:57.856 UTC [gossip/gossip] NewGossipService -&gt; INFO 019 Creating gossip service with self membership of {peer1.org2.example.com:7051 [] [184 95 210 205 234 253 19 19 255 176 119 142 250 223 118 247 95 25 197 147 101 148 47 67 225 171 185 33 92 112 40 122] peer1.org2.example.com:7051 &lt;nil&gt;}
peer1.org2.example.com    | 2018-07-02 08:45:57.859 UTC [gossip/gossip] start -&gt; INFO 01a Gossip instance peer1.org2.example.com:7051 started
peer1.org2.example.com    | 2018-07-02 08:45:57.861 UTC [cscc] Init -&gt; INFO 01b Init CSCC
peer1.org2.example.com    | 2018-07-02 08:45:57.861 UTC [sccapi] deploySysCC -&gt; INFO 01c system chaincode cscc/(github.com/hyperledger/fabric/core/scc/cscc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.862 UTC [sccapi] deploySysCC -&gt; INFO 01d system chaincode lscc/(github.com/hyperledger/fabric/core/scc/lscc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.863 UTC [escc] Init -&gt; INFO 01e Successfully initialized ESCC
peer1.org2.example.com    | 2018-07-02 08:45:57.863 UTC [sccapi] deploySysCC -&gt; INFO 01f system chaincode escc/(github.com/hyperledger/fabric/core/scc/escc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.864 UTC [sccapi] deploySysCC -&gt; INFO 020 system chaincode vscc/(github.com/hyperledger/fabric/core/scc/vscc) deployed
peer1.org2.example.com    | 2018-07-02 08:45:57.864 UTC [qscc] Init -&gt; INFO 021 Init QSCC
peer0.org2.example.com    |  OS/Arch: linux/amd64
peer0.org2.example.com    |  Experimental features: false
peer0.org2.example.com    |  Chaincode:
peer0.org2.example.com    |   Base Image Version: 0.4.6
peer0.org2.example.com    |   Base Docker Namespace: hyperledger
peer1.org2.example.com    | 2018-07-02 08:45:57.864 UTC [sccapi] deploySysCC -&gt; INFO 022 system chaincode qscc/(github.com/hyperledger/fabric/core/chaincode/qscc) deployed
peer0.org2.example.com    |   Base Docker Label: org.hyperledger.fabric
peer1.org2.example.com    | 2018-07-02 08:45:57.864 UTC [nodeCmd] initSysCCs -&gt; INFO 023 Deployed system chaincodes
peer0.org2.example.com    |   Docker Namespace: hyperledger
peer0.org2.example.com    |
er1.org2.example.com    | 2018-07-02 08:45:57.865 UTC [nodeCmd] serve -&gt; INFO 024 Starting peer with ID=[name:"peer1.org2.example.com" ], network ID=[dev], address=[peer1.org2.example.com:7051]
peer1.org2.example.com    | 2018-07-02 08:45:57.865 UTC [nodeCmd] serve -&gt; INFO 025 Started peer with ID=[name:"peer1.org2.example.com" ], network ID=[dev], address=[peer1.org2.example.com:7051]
peer0.org2.example.com    | 2018-07-02 08:45:57.875 UTC [ledgermgmt] initialize -&gt; INFO 003 Initializing ledger mgmt
peer1.org2.example.com    | 2018-07-02 08:45:57.866 UTC [nodeCmd] func7 -&gt; INFO 026 Starting profiling server with listenAddress = 0.0.0.0:6060
peer0.org2.example.com    | 2018-07-02 08:45:57.875 UTC [kvledger] NewProvider -&gt; INFO 004 Initializing ledger provider
peer0.org2.example.com    | 2018-07-02 08:45:57.890 UTC [kvledger] NewProvider -&gt; INFO 005 ledger provider Initialized
peer0.org2.example.com    | 2018-07-02 08:45:57.890 UTC [ledgermgmt] initialize -&gt; INFO 006 ledger mgmt initialized
peer0.org2.example.com    | 2018-07-02 08:45:57.891 UTC [peer] func1 -&gt; INFO 007 Auto-detected peer address: 172.18.0.6:7051
peer0.org2.example.com    | 2018-07-02 08:45:57.891 UTC [peer] func1 -&gt; INFO 008 Returning peer0.org2.example.com:7051
peer0.org2.example.com    | 2018-07-02 08:45:57.891 UTC [peer] func1 -&gt; INFO 009 Auto-detected peer address: 172.18.0.6:7051
peer0.org2.example.com    | 2018-07-02 08:45:57.891 UTC [peer] func1 -&gt; INFO 00a Returning peer0.org2.example.com:7051
peer0.org2.example.com    | 2018-07-02 08:45:57.892 UTC [nodeCmd] serve -&gt; INFO 00b Starting peer with TLS enabled
peer0.org2.example.com    | 2018-07-02 08:45:57.893 UTC [eventhub_producer] start -&gt; INFO 00c Event processor started
peer0.org2.example.com    | 2018-07-02 08:45:57.894 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00d Entering computeChaincodeEndpoint with peerHostname: peer0.org2.example.com
peer0.org2.example.com    | 2018-07-02 08:45:57.894 UTC [nodeCmd] computeChaincodeEndpoint -&gt; INFO 00e Exit with ccEndpoint: peer0.org2.example.com:7052
peer0.org2.example.com    | 2018-07-02 08:45:57.894 UTC [nodeCmd] createChaincodeServer -&gt; WARN 00f peer.chaincodeListenAddress is not set, using peer0.org2.example.com:7052
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [chaincode] NewChaincodeSupport -&gt; INFO 010 Chaincode support using peerAddress: peer0.org2.example.com:7052
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [sccapi] registerSysCC -&gt; INFO 011 system chaincode cscc(github.com/hyperledger/fabric/core/scc/cscc) registered
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [sccapi] registerSysCC -&gt; INFO 012 system chaincode lscc(github.com/hyperledger/fabric/core/scc/lscc) registered
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [sccapi] registerSysCC -&gt; INFO 013 system chaincode escc(github.com/hyperledger/fabric/core/scc/escc) registered
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [sccapi] registerSysCC -&gt; INFO 014 system chaincode vscc(github.com/hyperledger/fabric/core/scc/vscc) registered
peer0.org2.example.com    | 2018-07-02 08:45:57.897 UTC [sccapi] registerSysCC -&gt; INFO 015 system chaincode qscc(github.com/hyperledger/fabric/core/chaincode/qscc) registered
peer0.org2.example.com    | 2018-07-02 08:45:57.898 UTC [gossip/service] func1 -&gt; INFO 016 Initialize gossip with endpoint peer0.org2.example.com:7051 and bootstrap set [peer1.org2.example.com:7051]
peer0.org2.example.com    | 2018-07-02 08:45:57.899 UTC [msp] DeserializeIdentity -&gt; INFO 017 Obtaining identity
peer0.org2.example.com    | 2018-07-02 08:45:57.900 UTC [gossip/discovery] NewDiscoveryService -&gt; INFO 018 Started {peer0.org2.example.com:7051 [] [219 19 145 115 88 192 4 159 30 248 3 185 184 206 0 100 130 248 125 115 214 125 87 119 175 101 106 202 49 163 176 70] peer0.org2.example.com:7051 &lt;nil&gt;} incTime is 1530521157900760774
peer0.org2.example.com    | 2018-07-02 08:45:57.900 UTC [gossip/gossip] NewGossipService -&gt; INFO 019 Creating gossip service with self membership of {peer0.org2.example.com:7051 [] [219 19 145 115 88 192 4 159 30 248 3 185 184 206 0 100 130 248 125 115 214 125 87 119 175 101 106 202 49 163 176 70] peer0.org2.example.com:7051 &lt;nil&gt;}
peer0.org2.example.com    | 2018-07-02 08:45:57.902 UTC [gossip/gossip] start -&gt; INFO 01a Gossip instance peer0.org2.example.com:7051 started
peer0.org2.example.com    | 2018-07-02 08:45:57.902 UTC [cscc] Init -&gt; INFO 01b Init CSCC
peer0.org2.example.com    | 2018-07-02 08:45:57.903 UTC [sccapi] deploySysCC -&gt; INFO 01c system chaincode cscc/(github.com/hyperledger/fabric/core/scc/cscc) deployed
peer0.org2.example.com    | 2018-07-02 08:45:57.904 UTC [sccapi] deploySysCC -&gt; INFO 01d system chaincode lscc/(github.com/hyperledger/fabric/core/scc/lscc) deployed
peer0.org2.example.com    | 2018-07-02 08:45:57.904 UTC [escc] Init -&gt; INFO 01e Successfully initialized ESCC
peer0.org2.example.com    | 2018-07-02 08:45:57.906 UTC [msp] DeserializeIdentity -&gt; INFO 01f Obtaining identity
peer0.org2.example.com    | 2018-07-02 08:45:57.908 UTC [sccapi] deploySysCC -&gt; INFO 020 system chaincode escc/(github.com/hyperledger/fabric/core/scc/escc) deployed
peer0.org2.example.com    | 2018-07-02 08:45:57.909 UTC [sccapi] deploySysCC -&gt; INFO 021 system chaincode vscc/(github.com/hyperledger/fabric/core/scc/vscc) deployed
peer0.org2.example.com    | 2018-07-02 08:45:57.910 UTC [qscc] Init -&gt; INFO 022 Init QSCC
peer0.org2.example.com    | 2018-07-02 08:45:57.910 UTC [sccapi] deploySysCC -&gt; INFO 023 system chaincode qscc/(github.com/hyperledger/fabric/core/chaincode/qscc) deployed
peer0.org2.example.com    | 2018-07-02 08:45:57.910 UTC [nodeCmd] initSysCCs -&gt; INFO 024 Deployed system chaincodes
peer0.org2.example.com    | 2018-07-02 08:45:57.910 UTC [nodeCmd] serve -&gt; INFO 025 Starting peer with ID=[name:"peer0.org2.example.com" ], network ID=[dev], address=[peer0.org2.example.com:7051]
peer0.org2.example.com    | 2018-07-02 08:45:57.911 UTC [nodeCmd] serve -&gt; INFO 026 Started peer with ID=[name:"peer0.org2.example.com" ], network ID=[dev], address=[peer0.org2.example.com:7051]
peer0.org2.example.com    | 2018-07-02 08:45:57.912 UTC [nodeCmd] func7 -&gt; INFO 027 Starting profiling server with listenAddress = 0.0.0.0:6060
ERROR: An HTTP request took too long to complete. Retry with --verbose to obtain debug information.
If you encounter this issue regularly because of slow network conditions, consider setting COMPOSE_HTTP_TIMEOUT to a higher value (current value: 60).
</code></pre>
</div>

<p>上面有个报错信息，但是不影响整个网络的启动，只是说HTTP 请求太久而不能完成而已</p>

<p>网络启动顺序: 首先启动Orderer节点, 然后启动Peer节点</p>

<blockquote>
  <p>CLI容器将闲置1000秒。如果在需要时它消失了，可以用一个简单的命令重新启动它：</p>
</blockquote>

<blockquote>
  <p>​	$ sudo docker start cli</p>
</blockquote>

<p>fabric环境是运行在我们的docker容器中，那么我们需要先启动其环境，也就是他的各项服务，这些服务启动包括orderer组织和peer组织节点相关的服务启动</p>

<p>这里提一下Docker Compose</p>

<ul>
  <li>
    <p>Docker Compose是一个编排多容器分布式部署并且用来定义和运行复杂应用的Docker工具，提供命令集管理容器化应用的完整开发周期，包括服务构建，启动和停止。</p>
  </li>
  <li>
    <p>一个使用Docker容器的应用，通常由多个容器组成。使用Docker Compose就不再需要使用shell脚本来启动容器。</p>
  </li>
  <li>
    <p>Compose 通过一个配置文件来管理多个Docker容器，在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动，停止和重启应用，和应用中的服务以及所有依赖服务的容器，非常适合组合使用多个容器进行开发的场景</p>
  </li>
</ul>

<p>查看容器启动情况</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker ps
[sudo] parallels 的密码：
CONTAINER ID        IMAGE                               COMMAND             CREATED             STATUS              PORTS                                              NAMES
edf095471fc8        hyperledger/fabric-tools:latest     "/bin/bash"         About an hour ago   Up About an hour                                                       cli
54e57ebe05b9        hyperledger/fabric-peer:latest      "peer node start"   About an hour ago   Up About an hour    0.0.0.0:8051-&gt;7051/tcp, 0.0.0.0:8053-&gt;7053/tcp     peer1.org1.example.com
a325f1e55306        hyperledger/fabric-peer:latest      "peer node start"   About an hour ago   Up About an hour    0.0.0.0:10051-&gt;7051/tcp, 0.0.0.0:10053-&gt;7053/tcp   peer1.org2.example.com
098777e05ecf        hyperledger/fabric-peer:latest      "peer node start"   About an hour ago   Up About an hour    0.0.0.0:9051-&gt;7051/tcp, 0.0.0.0:9053-&gt;7053/tcp     peer0.org2.example.com
4453fca4c9e8        hyperledger/fabric-peer:latest      "peer node start"   About an hour ago   Up About an hour    0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp     peer0.org1.example.com
cbb7f39d4a31        hyperledger/fabric-orderer:latest   "orderer"           About an hour ago   Up About an hour    0.0.0.0:7050-&gt;7050/tcp                             orderer.example.com

</code></pre>
</div>

<p>说明启动网络正常</p>

<h3 id="进入docker容器">进入Docker容器</h3>
<p>启动网络后，Peer节点亦启动, 默认情况下没有加入网络中的任何应用通道, 也不会与Orderer服务建立连接.需要通过客户端对其进行操作, 让它加入网络和指定的应用通道中</p>

<p>执行如下命令进入到CLI容器中(后继操作都在容器中执行)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker exec -it cli bash
</code></pre>
</div>

<p>如果成功, 命令提示符会变为如下内容:</p>

<p>​<code class="highlighter-rouge">root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer#</code>
进入到了docker容器下的peer节点环境</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# ll
total 20
drwxr-xr-x 5 root root 4096 Jul  2 08:45 ./
drwxr-xr-x 3 root root 4096 Jul  2 08:45 ../
drwxr-xr-x 2 root root 4096 Jun 29 07:31 channel-artifacts/
drwxr-xr-x 4 root root 4096 Jun 29 06:17 crypto/
drwxr-xr-x 2 root root 4096 Jun 19 09:29 scripts/
</code></pre>
</div>
<p>在这个容器里，linux命令是可以正常使用，因为他也是基于linux的一个镜像系统</p>

<p>可以看到容器下的channel-artifacts文件夹里包含的文件都是从之前生成的文件里映射过来的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# ll channel-artifacts/
total 36
drwxr-xr-x 2 root root  4096 Jun 29 07:31 ./
drwxr-xr-x 5 root root  4096 Jul  2 08:45 ../
-rw-r--r-- 1 root root     0 Jun 19 09:29 .gitkeep
-rw-r--r-- 1 root root   284 Jun 29 07:30 Org1MSPanchors.tx
-rw-r--r-- 1 root root   284 Jun 29 07:31 Org2MSPanchors.tx
-rw-r--r-- 1 root root   346 Jun 29 07:16 channel.tx
-rw-r--r-- 1 root root 12643 Jun 29 06:34 genesis.block

</code></pre>
</div>
<p>crypto文件夹放置的是映射过来的组织结构和身份证书相关的文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# ll crypto/
total 16
drwxr-xr-x 4 root root 4096 Jun 29 06:17 ./
drwxr-xr-x 5 root root 4096 Jul  2 08:45 ../
drwxr-xr-x 3 root root 4096 Jun 29 06:17 ordererOrganizations/
drwxr-xr-x 4 root root 4096 Jun 29 06:17 peerOrganizations/
</code></pre>
</div>
<h3 id="创建通道">创建通道</h3>
<p>检查环境变量是否正确设置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>echo $CHANNEL_NAME
</code></pre>
</div>

<p>设置环境变量(声明一个通道名称，这个名称一定要与生成的通道配置文件里的记录的通道名称一致)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export CHANNEL_NAME=mychannel
</code></pre>
</div>

<p>创建通道</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre>
</div>
<p>参数说明：
-o:指定orderer服务地址
-c:指定创建的通道名称
-f:指定通道配置交易文件所在路径
–tls: 指定是否开启开启tls认证，默认是true
–cafile:既然开启了tls，后面就要指定orderer组织下msp的tls ca证书的路径（这个路径指的是容器下的路径，从容器的根目录下开始）</p>
<blockquote>
  <p>理论上应该要有参数来指定哪些peer组织节点可以加入到这个新创建的通道的，但是在这里，这个命令不需要这么一个参数来指定peer组织，因为依据的模板配置文件里已默认将org1和org2组织下所有节点都可以加入到该创建的应用通道里了（具有加入的资格）</p>
</blockquote>

<blockquote>
  <p>该命令自动在本地生成与该应用通道同名的初始区块 <strong>mychannel.block</strong>, 只有拥有该文件才可以加入创建的应用通道中(这个文件用以记录哪些节点可以加入到这个通道里，并且也要通过这个文件对要加入的这个通道的节点进行验证)</p>
</blockquote>

<p>查看:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# echo $CHANNEL_NAME

root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# export CHANNEL_NAME=mychannel
root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
2018-07-02 11:33:51.319 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-07-02 11:33:51.364 UTC [channelCmd] InitCmdFactory -&gt; INFO 002 Endorser and orderer connections initialized
2018-07-02 11:33:51.573 UTC [main] main -&gt; INFO 003 Exiting.....
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# ll
total 36
drwxr-xr-x 5 root root  4096 Jul  2 11:33 ./
drwxr-xr-x 3 root root  4096 Jul  2 08:45 ../
drwxr-xr-x 2 root root  4096 Jun 29 07:31 channel-artifacts/
drwxr-xr-x 4 root root  4096 Jun 29 06:17 crypto/
-rw-r--r-- 1 root root 15656 Jul  2 11:33 mychannel.block
drwxr-xr-x 2 root root  4096 Jun 19 09:29 scripts/
</code></pre>
</div>
<h3 id="加入通道">加入通道</h3>

<p>应用通道所包含组织的成员节点可以加入到通道中</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer channel join -b mychannel.block
</code></pre>
</div>
<p>执行上面那个命令后，默认是将org1下peer0节点加入到该通道里，而其他节点并未加入到该通道里，需要切换节点身份后一个一个的加入到该通道中</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root@d37743bcebfc:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel join -b mychannel.block
2018-07-02 11:46:47.489 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-07-02 11:46:47.547 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
2018-07-02 11:46:47.547 UTC [main] main -&gt; INFO 003 Exiting.....

</code></pre>
</div>
<p>join命令: 将本Peer节点加入到某个应用通道中</p>

<p>​参数含义</p>

<p>-b:  初始区块文件的路径信息</p>

<blockquote>
  <p>执行成功后, Peer连接到该应用通道的Ordering服务上, 开始接收区块信息</p>
</blockquote>

<h3 id="更新锚节点">更新锚节点</h3>

<p>使用Org1的管理员身份更新锚节点配置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org1MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre>
</div>

<p>使用Org2的管理员身份更新锚节点配置</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CORE_PEER_LOCALMSPID="Org2MSP"
CORE_PEER_ADDRESS=peer0.org2.example.com:7051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org2MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</code></pre>
</div>
<p>更新锚节点是针对实际生产环境下的，测试开发阶段可以不用</p>

<p>手动配置网络完成, 可以测试Chaincode</p>

<h3 id="关闭网络-1">关闭网络</h3>

<p>命令：<code class="highlighter-rouge">$ sudo docker-compose -f docker-compose-cli.yaml down</code>
输出信息：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Stopping cli ... done
Stopping peer1.org1.example.com ... done
Stopping peer1.org2.example.com ... done
Stopping peer0.org2.example.com ... done
Stopping peer0.org1.example.com ... done
Stopping orderer.example.com ... done
Removing cli ... done
Removing peer1.org1.example.com ... done
Removing peer1.org2.example.com ... done
Removing peer0.org2.example.com ... done
Removing peer0.org1.example.com ... done
Removing orderer.example.com ... done
Removing network net_byfn
$ sudo docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</code></pre>
</div>
<p>网络正常关闭，所有开启的节点服务也都关闭了
不过不同于自启动使用自动化脚本来关闭网络的方式，crypto-config和channel-artifacts文件夹下的文件并不会给移除了</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ ll
总用量 104
drwxr-xr-x  7 root root  4096 Jun 29 14:17 ./
drwxr-xr-x 14 root root  4096 Jun 19 17:32 ../
drwxr-xr-x  2 root root  4096 Jun 19 17:29 base/
-rwxr-xr-x  1 root root 20114 Jun 19 17:29 byfn.sh*
drwxr-xr-x  2 root root  4096 Jun 29 15:31 channel-artifacts/
-rw-r--r--  1 root root  7912 Jun 19 17:29 configtx.yaml
drwxr-xr-x  4 root root  4096 Jun 29 14:17 crypto-config/
-rw-r--r--  1 root root  4039 Jun 29 14:17 crypto-config.yaml
-rw-r--r--  1 root root  2971 Jun 19 17:29 docker-compose-cli.yaml
-rw-r--r--  1 root root  2345 Jun 19 17:29 docker-compose-couch-org3.yaml
-rw-r--r--  1 root root  4560 Jun 19 17:29 docker-compose-couch.yaml
-rw-r--r--  1 root root  2883 Jun 19 17:29 docker-compose-e2e-template.yaml
-rw-r--r--  1 root root  3493 Jun 19 17:29 docker-compose-org3.yaml
-rw-r--r--  1 root root    42 Jun 19 17:29 .env
-rwxr-xr-x  1 root root 10627 Jun 19 17:29 eyfn.sh*
drwxr-xr-x  2 root root  4096 Jun 19 17:29 org3-artifacts/
-rw-r--r--  1 root root   335 Jun 19 17:29 README.md
drwxr-xr-x  2 root root  4096 Jun 19 17:29 scripts/
$ ll crypto-config
总用量 16
drwxr-xr-x 4 root root 4096 Jun 29 14:17 ./
drwxr-xr-x 7 root root 4096 Jun 29 14:17 ../
drwxr-xr-x 3 root root 4096 Jun 29 14:17 ordererOrganizations/
drwxr-xr-x 4 root root 4096 Jun 29 14:17 peerOrganizations/
$ ll channel-artifacts/
总用量 36
drwxr-xr-x 2 root root  4096 Jun 29 15:31 ./
drwxr-xr-x 7 root root  4096 Jun 29 14:17 ../
-rw-r--r-- 1 root root   346 Jun 29 15:16 channel.tx
-rw-r--r-- 1 root root 12643 Jun 29 14:34 genesis.block
-rw-r--r-- 1 root root     0 Jun 19 17:29 .gitkeep
-rw-r--r-- 1 root root   284 Jun 29 15:30 Org1MSPanchors.tx
-rw-r--r-- 1 root root   284 Jun 29 15:31 Org2MSPanchors.tx
</code></pre>
</div>
<p>这里提个小技巧，就是在终端使用命令时，有时记不住命令，比如docker-compose命令，你在敲字母到 doc 时按下缩进键（tab键）可以自动补齐这个命令后面三个字母 ker ，加上 - 再按下缩进键会有如下效果(会显示中划线后面的内容)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker-
docker-compose  docker-init     docker-proxy
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo docker-compose -f docker-compose-cli.yaml down
Removing network net_byfn
WARNING: Network net_byfn not found.

</code></pre>
</div>
<p>上面显示这个信息说明网络没开启或者已经关闭了</p>

<p>问题汇总：</p>

<ul>
  <li>orderer组织只能是一个吗？，一个orderer组织可以只有一个orderer节点，也可以有多个orderer节点，形成集群?</li>
  <li>锚节点不是选举产生的，而是指定的，那么一旦锚节点宕机了，该怎么办呢？</li>
  <li>为什么有些电脑的ubuntu系统下终端里执行<code class="highlighter-rouge">sudo usermod -aG docker parallels</code>没有效果？</li>
  <li>执行<code class="highlighter-rouge">peer channel join -b mychannel.block</code>命令后，默认是将org1下peer0节点加入到该通道里，而其他节点并未加入到该通道里，需要切换节点身份后一个一个的加入到该通道中,那么如何切换节点身份？</li>
</ul>

  </section>
  <h2 style="color:red"><strong>版权声明：博客中的文章版权归博主所有，不可作商用，转载请注明出处，合作请联系：Gump(微信)</strong></h2>
</article>

<section>

            <div class="content-play">
              <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">打赏一个呗</a></p>
              <div class="hide_box-play"></div>
              <div class="shang_box-play">
                <a class="shang_close-play" href="javascript:void(0)" onclick="dashangToggle()" title="关闭"><img src="/images/payimg/close.jpg" alt="取消" /></a>
                <div class="shang_tit-play">
                  <p>感谢您的支持，我会继续努力的!</p>
                </div>
                <div class="shang_payimg">
                    <!-- <span>扫码支持</span> -->
                    <img src="/images/payimg/alipayimg.png" alt="扫码支持" title="扫一扫" />
                </div>
              <div class="shang_payimg">
                    <img src="/images/payimg/weipayimg.png" alt="扫码支持" title="扫一扫" />
                </div>
                <div class="pay_explain">扫码打赏，你说多少就多少</div>
                <div class="shang_payselect">
                  <div class="pay_item checked" data-id="alipay">
                    <span class="pay_logo"><img src="/images/payimg/alipay.jpg" alt="支付宝" /></span>
                  </div>
                  <div class="pay_item" data-id="weipay">
                    <span class="pay_logo"><img src="/images/payimg/wechat.jpg" alt="微信" /></span>
                  </div>
                </div>
                <div class="shang_info-play">
                  <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
                </div>
              </div>
            </div>
            <script type="text/javascript">
            function dashangToggle(){
              $(".hide_box-play").fadeToggle();
              $(".shang_box-play").fadeToggle();
            }
            </script>

            <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

            <style type="text/css">
              .content-play{width:80%;margin-top: 20px;margin-bottom: 10px;height:40px;}
              .hide_box-play{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
              .shang_box-play{width:540px;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:50%;top:50%;margin-left:-280px;margin-top:-280px;border:1px dotted #dedede;display:none;}
              .shang_box-play img{border:none;border-width:0;}
              .dashang{display:block;width:100px;margin:5px auto;height:25px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
              .dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
              .shang_close-play{float:right;display:inline-block;
                margin-right: 10px;margin-top: 20px;
              }
              .shang_logo{display:block;text-align:center;margin:20px auto;}
              .shang_tit-play{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;background: url('/images/payimg/cy-reward-title-bg.jpg');font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
              .shang_tit-play p{color:#a3a3a3;text-align:center;font-size:16px;}
              .shang_payimg{width:140px;padding:10px;padding-left: 80px; /*border:6px solid #EA5F00;**/margin:0 auto;border-radius:3px;height:140px;display:inline-block;}
              .shang_payimg img{display:inline-block;margin-right:10px;float:left;text-align:center;width:140px;height:140px; }
              .pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
              .shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:500px;margin-left:110px;}
              .shang_payselect .pay_item{display:inline-block;margin-right:140px;float:left;}
              .shang_info-play{clear:both;}
              .shang_info-play p,.shang_info-play a{color:#C3C3C3;text-align:center;font-size:12px;text-decoration:none;line-height:2em;}
            </style>

       <ul class="pager">
        
        <li class="previous">
            <a href="/2018/03/16/fabric%E7%9F%A5%E8%AF%861/" data-toggle="tooltip" data-placement="top" title="Hyperledger Fabric知识记录（1）-- 概念与环境搭建">上一篇：  <span>Hyperledger Fabric知识记录（1）-- 概念与环境搭建</span>
            </a>
        </li>
        
        
    </ul>
</section>

<section class="post-comments">
  <!--PC和WAP自适应版-->
<div id="SOHUCS" sid=Hyperledger Fabric知识记录（2）-- Fabric网络的自启动和手启动 ></div>
<script type="text/javascript">
(function(){
var appid = 'cytfSz8yx';
var conf = 'prod_ad710bf09d342725ed536beddc68aa27';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("http://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
</section>

 <section class="footer">
  <footer>
    <div class="footer_div">
      <nav class="cover-navigation navigation--social">
        <ul class="navigation">

          
          <!-- Weibo -->
          <li class="navigation__item_social">
            <a href="http://weibo.com/5351843558" title="@5351843558 的微博" target="_blank">
              <i class='social fa fa-weibo fa-2x'></i>
              <span class="label">Weibo</span>
            </a>
          </li>
           
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/chengpizi" title="@chengpizi 的 Github" target="_blank">
              <i class='social fa fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
            

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='social fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:1822300185@qq.com" title="Contact me">
              <i class='social fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          

        </ul>
      </nav>

    </div>

    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <thead>
        <tr id="bar_head">
          <th colspan="11">友情链接</th>
        </tr>
      </thead>

      <tr align="center" valign="middle">
          <td><a href="http://www.kongyixueyuan.com">区块链技术视频网站</a></td>

          <td><a href="https://www.ethereum.org">以太坊官网</a></td>

          <td><a href="https://solidity.readthedocs.io/en/develop/">Solidity</a></td>

          <td><a href="http://truffleframework.com/">Truffle FrameWork</a></td>

          <td><a href="http://embark.readthedocs.io">Embark FrameWork</a></td>

      </tr>
      <tr align="center" valign="middle">

          <td><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=3302cc3b-074e-44da-90b1-5055f1dc0d9c&amp;lang=zh">IBM开源技术微讲堂</a></td>

          <td><a href="https://www.bitcoin.com/">Bitcoin.com</a></td>

          <td><a href="https://github.com/bitshares/bitshares1-core">bitshares1-core</a></td>

          <td><a href="https://ipfs.io">ipfs官网</a></td>

          <td><a href="http://ipfser.org">ipfs中文网</a></td>

      </tr>
    </table>

    <div class="footer_div">
      <p class="copyright text-muted">
        Copyright &copy; 2018 Gump区块链博客 京ICP备15065741号. 
      </p>
      <div align="right">
        <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <!-- 访问统计 -->
        <span id="busuanzi_container_site_pv">
            本站总访问量
            <span id="busuanzi_value_site_pv"></span>次
        </span>

      </div>
      <div>
  </footer>
</section>

    </div>
  </div>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


</body>

</html>